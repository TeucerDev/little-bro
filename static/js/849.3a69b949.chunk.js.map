{"version":3,"file":"static/js/849.3a69b949.chunk.js","mappings":"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","sources":["Components/Weapon/WeaponSelectionModal.tsx","Components/RefinementDropdown.tsx","PageWeapon/WeaponEditor.tsx"],"sourcesContent":["import { Box, CardActionArea, CardContent, Divider, Grid, TextField, Typography } from \"@mui/material\"\r\nimport { ChangeEvent, useDeferredValue, useEffect, useState } from \"react\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport Assets from \"../../Assets/Assets\"\r\nimport WeaponSheet from \"../../Data/Weapons/WeaponSheet\"\r\nimport usePromise from \"../../ReactHooks/usePromise\"\r\nimport { allWeaponKeys, allWeaponTypeKeys, WeaponKey, WeaponTypeKey } from \"../../Types/consts\"\r\nimport CardDark from \"../Card/CardDark\"\r\nimport CardLight from \"../Card/CardLight\"\r\nimport CloseButton from \"../CloseButton\"\r\nimport ImgIcon from \"../Image/ImgIcon\"\r\nimport ModalWrapper from \"../ModalWrapper\"\r\nimport { StarsDisplay } from \"../StarDisplay\"\r\nimport WeaponToggle from \"../ToggleButton/WeaponToggle\"\r\n\r\ntype WeaponSelectionModalProps = {\r\n  show: boolean,\r\n  ascension?: number,\r\n  onHide: () => void,\r\n  onSelect: (wKey: WeaponKey) => void,\r\n  filter?: (sheet: WeaponSheet) => boolean,\r\n  weaponTypeFilter?: WeaponTypeKey,\r\n}\r\n\r\nexport default function WeaponSelectionModal({ show, ascension = 0, onHide, onSelect, filter = () => true, weaponTypeFilter }: WeaponSelectionModalProps) {\r\n  const { t } = useTranslation([\"page_weapon\", \"weaponNames_gen\"])\r\n  const weaponSheets = usePromise(() => WeaponSheet.getAll, [])\r\n  const [weaponFilter, setWeaponfilter] = useState<WeaponTypeKey[]>(weaponTypeFilter ? [weaponTypeFilter] : [...allWeaponTypeKeys])\r\n\r\n  useEffect(() => weaponTypeFilter && setWeaponfilter([weaponTypeFilter]), [weaponTypeFilter])\r\n\r\n  const [searchTerm, setSearchTerm] = useState(\"\")\r\n  const deferredSearchTerm = useDeferredValue(searchTerm)\r\n\r\n  const weaponIdList = !weaponSheets ? [] : allWeaponKeys.filter(wKey => filter(weaponSheets[wKey]))\r\n    .filter(wKey => weaponFilter.includes(weaponSheets?.[wKey]?.weaponType))\r\n    .filter(wKey => !deferredSearchTerm || t(`weaponNames_gen:${wKey}`).toLowerCase().includes(deferredSearchTerm.toLowerCase()))\r\n    .sort((a, b) => (weaponSheets?.[b]?.rarity ?? 0) - (weaponSheets?.[a]?.rarity ?? 0))\r\n\r\n  if (!weaponSheets) return null\r\n\r\n  return <ModalWrapper open={show} onClose={onHide}>\r\n    <CardDark>\r\n      <CardContent sx={{ py: 1 }}>\r\n        <Grid container spacing={1}>\r\n          <Grid item>\r\n            <WeaponToggle value={weaponFilter} onChange={setWeaponfilter} disabled={!!weaponTypeFilter} size=\"small\" />\r\n          </Grid >\r\n          <Grid item flexGrow={1}>\r\n            <TextField\r\n              autoFocus\r\n              size=\"small\"\r\n              value={searchTerm}\r\n              onChange={(e: ChangeEvent<HTMLTextAreaElement>) => setSearchTerm(e.target.value)}\r\n              label={t(\"weaponName\")}\r\n              sx={{ height: \"100%\" }}\r\n              InputProps={{\r\n                sx: { height: \"100%\" }\r\n              }}\r\n            />\r\n          </Grid>\r\n          <Grid item>\r\n            <CloseButton onClick={onHide} />\r\n          </Grid >\r\n        </Grid>\r\n      </CardContent>\r\n      <Divider />\r\n      <CardContent><Grid container spacing={1}>\r\n        {weaponIdList.map(weaponKey => {\r\n          const weaponSheet = weaponSheets[weaponKey]\r\n          return <Grid item key={weaponKey} lg={3} md={4}>\r\n            <CardLight sx={{ height: \"100%\" }} >\r\n              <CardActionArea onClick={() => { onHide(); onSelect(weaponKey) }} sx={{ display: \"flex\" }}>\r\n                <Box component=\"img\" src={weaponSheet.getImg(ascension)} sx={{ width: 100, height: \"auto\" }} className={` grad-${weaponSheet.rarity}star`} />\r\n                <Box sx={{ flexGrow: 1, px: 1 }}>\r\n                  <Typography variant=\"subtitle1\">{weaponSheet.name}</Typography>\r\n                  <Typography><ImgIcon src={Assets.weaponTypes?.[weaponSheet.weaponType]} /> <StarsDisplay stars={weaponSheet.rarity} colored /></Typography>\r\n                </Box>\r\n              </CardActionArea>\r\n            </CardLight>\r\n          </Grid>\r\n        })}\r\n      </Grid></CardContent>\r\n      <Divider />\r\n      <CardContent sx={{ py: 1 }}>\r\n        <CloseButton large onClick={onHide} />\r\n      </CardContent>\r\n    </CardDark>\r\n  </ModalWrapper>\r\n}\r\n","import { MenuItem } from \"@mui/material\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport { allRefinement, Refinement } from \"../Types/consts\"\r\nimport DropdownButton from \"./DropdownMenu/DropdownButton\"\r\n\r\nexport default function RefinementDropdown({ refinement, setRefinement }: { refinement: Refinement, setRefinement: (r: Refinement) => void }) {\r\n  const { t } = useTranslation(\"ui\")\r\n  return <DropdownButton title={t(\"refinement\", { value: refinement })}>\r\n    {allRefinement.map(r =>\r\n      <MenuItem key={r} onClick={() => setRefinement(r)} selected={refinement === r} disabled={refinement === r}>\r\n        {t(\"refinement\", { value: r })}\r\n      </MenuItem>)}\r\n  </DropdownButton>\r\n}\r\n","import { BusinessCenter, Lock, LockOpen } from \"@mui/icons-material\"\r\nimport { Box, Button, ButtonGroup, CardContent, CardHeader, Divider, Grid, ListItem, Typography } from \"@mui/material\"\r\nimport { useCallback, useContext, useEffect, useMemo } from \"react\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport CardDark from \"../Components/Card/CardDark\"\r\nimport CardLight from \"../Components/Card/CardLight\"\r\nimport CharacterAutocomplete from \"../Components/Character/CharacterAutocomplete\"\r\nimport CloseButton from \"../Components/CloseButton\"\r\nimport DocumentDisplay from \"../Components/DocumentDisplay\"\r\nimport { FieldDisplayList, NodeFieldDisplay } from \"../Components/FieldDisplay\"\r\nimport LevelSelect from \"../Components/LevelSelect\"\r\nimport ModalWrapper from \"../Components/ModalWrapper\"\r\nimport RefinementDropdown from \"../Components/RefinementDropdown\"\r\nimport { StarsDisplay } from \"../Components/StarDisplay\"\r\nimport WeaponSelectionModal from \"../Components/Weapon/WeaponSelectionModal\"\r\nimport { DataContext } from \"../Context/DataContext\"\r\nimport CharacterSheet from \"../Data/Characters/CharacterSheet\"\r\nimport { milestoneLevelsLow } from \"../Data/LevelData\"\r\nimport WeaponSheet from \"../Data/Weapons/WeaponSheet\"\r\nimport { DatabaseContext } from \"../Database/Database\"\r\nimport { uiInput as input } from \"../Formula\"\r\nimport { computeUIData, dataObjForWeapon } from \"../Formula/api\"\r\nimport useBoolState from \"../ReactHooks/useBoolState\"\r\nimport usePromise from \"../ReactHooks/usePromise\"\r\nimport useWeapon from \"../ReactHooks/useWeapon\"\r\nimport { CharacterKey } from \"../Types/consts\"\r\nimport { ICachedWeapon } from \"../Types/weapon\"\r\n\r\ntype WeaponStatsEditorCardProps = {\r\n  weaponId: string\r\n  footer?: boolean\r\n  onClose?: () => void\r\n  extraButtons?: JSX.Element\r\n}\r\nexport default function WeaponEditor({\r\n  weaponId: propWeaponId,\r\n  footer = false,\r\n  onClose,\r\n  extraButtons\r\n}: WeaponStatsEditorCardProps) {\r\n  const { t } = useTranslation(\"ui\")\r\n  const { data } = useContext(DataContext)\r\n\r\n  const { database } = useContext(DatabaseContext)\r\n  const weapon = useWeapon(propWeaponId)\r\n  const { key = \"\", level = 0, refinement = 1, ascension = 0, lock, location = \"\", id } = weapon ?? {}\r\n  const weaponSheet = usePromise(() => WeaponSheet.get(key), [key])\r\n\r\n  const weaponDispatch = useCallback((newWeapon: Partial<ICachedWeapon>) => {\r\n    database.weapons.set(propWeaponId, newWeapon)\r\n  }, [propWeaponId, database])\r\n\r\n  const characterSheet = usePromise(() => location ? CharacterSheet.get(location) : undefined, [location])\r\n\r\n  const initialWeaponFilter = characterSheet && characterSheet.weaponTypeKey\r\n\r\n  const equipOnChar = useCallback((charKey: CharacterKey | \"\") => id && database.weapons.set(id, { location: charKey }), [database, id])\r\n  const filter = useCallback(\r\n    (cs: CharacterSheet) => cs.weaponTypeKey === weaponSheet?.weaponType,\r\n    [weaponSheet],\r\n  )\r\n\r\n  const [showModal, onShowModal, onHideModal] = useBoolState()\r\n  const img = weaponSheet?.getImg(ascension)\r\n\r\n  //check the levels when switching from a 5* to a 1*, for example.\r\n  useEffect(() => {\r\n    if (!weaponSheet || !weaponDispatch || weaponSheet.key !== weapon?.key) return\r\n    if (weaponSheet.rarity <= 2 && (level > 70 || ascension > 4)) {\r\n      const [level, ascension] = milestoneLevelsLow[0]\r\n      weaponDispatch({ level, ascension })\r\n    }\r\n  }, [weaponSheet, weapon, weaponDispatch, level, ascension])\r\n\r\n\r\n  const weaponUIData = useMemo(() => weaponSheet && weapon && computeUIData([weaponSheet.data, dataObjForWeapon(weapon)]), [weaponSheet, weapon])\r\n  return <ModalWrapper open={!!propWeaponId} onClose={onClose} containerProps={{ maxWidth: \"md\" }}><CardLight>\r\n    <WeaponSelectionModal ascension={ascension} show={showModal} onHide={onHideModal} onSelect={k => weaponDispatch({ key: k })} weaponTypeFilter={initialWeaponFilter} />\r\n    <CardContent >\r\n      {weaponSheet && weaponUIData && <Grid container spacing={1.5}>\r\n        <Grid item xs={12} sm={3}>\r\n          <Grid container spacing={1.5}>\r\n            <Grid item xs={6} sm={12}>\r\n              <Box component=\"img\" src={img} className={`grad-${weaponSheet.rarity}star`} sx={{ maxWidth: 256, width: \"100%\", height: \"auto\", borderRadius: 1 }} />\r\n            </Grid>\r\n            <Grid item xs={6} sm={12}>\r\n              <Typography><small>{weaponSheet.description}</small></Typography>\r\n            </Grid>\r\n          </Grid>\r\n        </Grid>\r\n        <Grid item xs={12} sm={9} sx={{ display: \"flex\", flexDirection: \"column\", gap: 1 }}>\r\n          <Box display=\"flex\" gap={1} flexWrap=\"wrap\" justifyContent=\"space-between\">\r\n            <ButtonGroup>\r\n              <Button color=\"info\" onClick={onShowModal} >{weaponSheet?.name ?? \"Select a Weapon\"}</Button>\r\n              {weaponSheet?.hasRefinement && <RefinementDropdown refinement={refinement} setRefinement={r => weaponDispatch({ refinement: r })} />}\r\n              {extraButtons}\r\n            </ButtonGroup>\r\n          </Box>\r\n          <Box display=\"flex\" gap={1} flexWrap=\"wrap\" justifyContent=\"space-between\">\r\n            {weaponSheet && <LevelSelect level={level} ascension={ascension} setBoth={weaponDispatch} useLow={!weaponSheet.hasRefinement} />}\r\n            <Button color=\"error\" onClick={() => id && database.weapons.set(id, { lock: !lock })} startIcon={lock ? <Lock /> : <LockOpen />}>\r\n              {lock ? \"Locked\" : \"Unlocked\"}\r\n            </Button>\r\n          </Box>\r\n          <Typography><StarsDisplay stars={weaponSheet.rarity} /></Typography>\r\n          <Typography variant=\"subtitle1\"><strong>{weaponSheet.passiveName}</strong></Typography>\r\n          <Typography gutterBottom>{weaponSheet.passiveName && weaponSheet.passiveDescription(weaponUIData.get(input.weapon.refineIndex).value)}</Typography>\r\n          <Box display=\"flex\" flexDirection=\"column\" gap={1}>\r\n            <CardDark >\r\n              <CardHeader title={\"Main Stats\"} titleTypographyProps={{ variant: \"subtitle2\" }} />\r\n              <Divider />\r\n              <FieldDisplayList>\r\n                {[input.weapon.main, input.weapon.sub, input.weapon.sub2].map((node, i) => {\r\n                  const n = weaponUIData.get(node)\r\n                  if (n.isEmpty || !n.value) return null\r\n                  return <NodeFieldDisplay key={n.info.key} node={n} component={ListItem} />\r\n                })}\r\n              </FieldDisplayList>\r\n            </CardDark>\r\n            {data && weaponSheet.document && <DocumentDisplay sections={weaponSheet.document} />}\r\n          </Box>\r\n        </Grid>\r\n      </Grid>}\r\n    </CardContent>\r\n    {footer && id && <CardContent sx={{ py: 1 }}>\r\n      <Grid container spacing={1}>\r\n        <Grid item flexGrow={1}>\r\n          <CharacterAutocomplete showDefault size=\"small\" defaultIcon={<BusinessCenter />} defaultText={t(\"inventory\")} value={location} onChange={equipOnChar} filter={filter} disable={(v: any) => v === \"\"} disableClearable />\r\n        </Grid>\r\n        <Grid item flexGrow={2} />\r\n        {!!onClose && <Grid item><CloseButton sx={{ height: \"100%\" }} large onClick={onClose} /></Grid>}\r\n      </Grid>\r\n    </CardContent>}\r\n  </CardLight ></ModalWrapper>\r\n}\r\n"],"names":["WeaponSelectionModal","show","ascension","onHide","onSelect","filter","weaponTypeFilter","t","useTranslation","weaponSheets","usePromise","WeaponSheet","useState","allWeaponTypeKeys","weaponFilter","setWeaponfilter","useEffect","searchTerm","setSearchTerm","deferredSearchTerm","useDeferredValue","weaponIdList","allWeaponKeys","wKey","includes","weaponType","toLowerCase","sort","a","b","rarity","open","onClose","sx","py","container","spacing","item","value","onChange","disabled","size","flexGrow","autoFocus","e","target","label","height","InputProps","onClick","map","weaponKey","weaponSheet","lg","md","display","component","src","getImg","width","className","px","variant","name","Assets","stars","colored","large","RefinementDropdown","refinement","setRefinement","DropdownButton","title","allRefinement","r","MenuItem","selected","WeaponEditor","propWeaponId","weaponId","footer","extraButtons","data","useContext","DataContext","database","DatabaseContext","weapon","useWeapon","key","level","lock","location","id","weaponDispatch","useCallback","newWeapon","weapons","set","characterSheet","CharacterSheet","undefined","initialWeaponFilter","weaponTypeKey","equipOnChar","charKey","cs","useBoolState","showModal","onShowModal","onHideModal","img","milestoneLevelsLow","weaponUIData","useMemo","computeUIData","dataObjForWeapon","ModalWrapper","containerProps","maxWidth","CardLight","k","CardContent","Grid","xs","sm","Box","borderRadius","Typography","description","flexDirection","gap","flexWrap","justifyContent","ButtonGroup","Button","color","hasRefinement","LevelSelect","setBoth","useLow","startIcon","Lock","LockOpen","passiveName","gutterBottom","passiveDescription","get","input","CardDark","CardHeader","titleTypographyProps","Divider","FieldDisplay","node","i","n","isEmpty","ListItem","info","document","DocumentDisplay","sections","CharacterAutocomplete","showDefault","defaultIcon","BusinessCenter","defaultText","disable","v","disableClearable","CloseButton"],"sourceRoot":""}
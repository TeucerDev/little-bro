{"version":3,"file":"static/js/923.5e0cbcb3.chunk.js","mappings":"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","sources":["PageWeapon/WeaponEditor.tsx"],"sourcesContent":["import { BusinessCenter, Lock, LockOpen } from \"@mui/icons-material\"\r\nimport { Box, Button, ButtonGroup, CardContent, CardHeader, Divider, Grid, ListItem, Typography } from \"@mui/material\"\r\nimport { useCallback, useContext, useEffect, useMemo } from \"react\"\r\nimport { useTranslation } from \"react-i18next\"\r\nimport CardDark from \"../Components/Card/CardDark\"\r\nimport CardLight from \"../Components/Card/CardLight\"\r\nimport CharacterAutocomplete from \"../Components/Character/CharacterAutocomplete\"\r\nimport CloseButton from \"../Components/CloseButton\"\r\nimport DocumentDisplay from \"../Components/DocumentDisplay\"\r\nimport { FieldDisplayList, NodeFieldDisplay } from \"../Components/FieldDisplay\"\r\nimport LevelSelect from \"../Components/LevelSelect\"\r\nimport ModalWrapper from \"../Components/ModalWrapper\"\r\nimport RefinementDropdown from \"../Components/RefinementDropdown\"\r\nimport { StarsDisplay } from \"../Components/StarDisplay\"\r\nimport WeaponSelectionModal from \"../Components/Weapon/WeaponSelectionModal\"\r\nimport { DataContext } from \"../Context/DataContext\"\r\nimport CharacterSheet from \"../Data/Characters/CharacterSheet\"\r\nimport { milestoneLevelsLow } from \"../Data/LevelData\"\r\nimport WeaponSheet from \"../Data/Weapons/WeaponSheet\"\r\nimport { DatabaseContext } from \"../Database/Database\"\r\nimport { uiInput as input } from \"../Formula\"\r\nimport { computeUIData, dataObjForWeapon } from \"../Formula/api\"\r\nimport useBoolState from \"../ReactHooks/useBoolState\"\r\nimport usePromise from \"../ReactHooks/usePromise\"\r\nimport useWeapon from \"../ReactHooks/useWeapon\"\r\nimport { CharacterKey } from \"../Types/consts\"\r\nimport { ICachedWeapon } from \"../Types/weapon\"\r\n\r\ntype WeaponStatsEditorCardProps = {\r\n  weaponId: string\r\n  footer?: boolean\r\n  onClose?: () => void\r\n  extraButtons?: JSX.Element\r\n}\r\nexport default function WeaponEditor({\r\n  weaponId: propWeaponId,\r\n  footer = false,\r\n  onClose,\r\n  extraButtons\r\n}: WeaponStatsEditorCardProps) {\r\n  const { t } = useTranslation(\"ui\")\r\n  const { data } = useContext(DataContext)\r\n\r\n  const { database } = useContext(DatabaseContext)\r\n  const weapon = useWeapon(propWeaponId)\r\n  const { key = \"\", level = 0, refinement = 1, ascension = 0, lock, location = \"\", id } = weapon ?? {}\r\n  const weaponSheet = usePromise(() => WeaponSheet.get(key), [key])\r\n\r\n  const weaponDispatch = useCallback((newWeapon: Partial<ICachedWeapon>) => {\r\n    database.weapons.set(propWeaponId, newWeapon)\r\n  }, [propWeaponId, database])\r\n\r\n  const characterSheet = usePromise(() => location ? CharacterSheet.get(location) : undefined, [location])\r\n\r\n  const initialWeaponFilter = characterSheet && characterSheet.weaponTypeKey\r\n\r\n  const equipOnChar = useCallback((charKey: CharacterKey | \"\") => id && database.weapons.set(id, { location: charKey }), [database, id])\r\n  const filter = useCallback(\r\n    (cs: CharacterSheet) => cs.weaponTypeKey === weaponSheet?.weaponType,\r\n    [weaponSheet],\r\n  )\r\n\r\n  const [showModal, onShowModal, onHideModal] = useBoolState()\r\n  const img = weaponSheet?.getImg(ascension)\r\n\r\n  //check the levels when switching from a 5* to a 1*, for example.\r\n  useEffect(() => {\r\n    if (!weaponSheet || !weaponDispatch || weaponSheet.key !== weapon?.key) return\r\n    if (weaponSheet.rarity <= 2 && (level > 70 || ascension > 4)) {\r\n      const [level, ascension] = milestoneLevelsLow[0]\r\n      weaponDispatch({ level, ascension })\r\n    }\r\n  }, [weaponSheet, weapon, weaponDispatch, level, ascension])\r\n\r\n\r\n  const weaponUIData = useMemo(() => weaponSheet && weapon && computeUIData([weaponSheet.data, dataObjForWeapon(weapon)]), [weaponSheet, weapon])\r\n  return <ModalWrapper open={!!propWeaponId} onClose={onClose} containerProps={{ maxWidth: \"md\" }}><CardLight>\r\n    <WeaponSelectionModal ascension={ascension} show={showModal} onHide={onHideModal} onSelect={k => weaponDispatch({ key: k })} weaponTypeFilter={initialWeaponFilter} />\r\n    <CardContent >\r\n      {weaponSheet && weaponUIData && <Grid container spacing={1.5}>\r\n        <Grid item xs={12} sm={3}>\r\n          <Grid container spacing={1.5}>\r\n            <Grid item xs={6} sm={12}>\r\n              <Box component=\"img\" src={img} className={`grad-${weaponSheet.rarity}star`} sx={{ maxWidth: 256, width: \"100%\", height: \"auto\", borderRadius: 1 }} />\r\n            </Grid>\r\n            <Grid item xs={6} sm={12}>\r\n              <Typography><small>{weaponSheet.description}</small></Typography>\r\n            </Grid>\r\n          </Grid>\r\n        </Grid>\r\n        <Grid item xs={12} sm={9} sx={{ display: \"flex\", flexDirection: \"column\", gap: 1 }}>\r\n          <Box display=\"flex\" gap={1} flexWrap=\"wrap\" justifyContent=\"space-between\">\r\n            <ButtonGroup>\r\n              <Button color=\"info\" onClick={onShowModal} >{weaponSheet?.name ?? \"Select a Weapon\"}</Button>\r\n              {weaponSheet?.hasRefinement && <RefinementDropdown refinement={refinement} setRefinement={r => weaponDispatch({ refinement: r })} />}\r\n              {extraButtons}\r\n            </ButtonGroup>\r\n          </Box>\r\n          <Box display=\"flex\" gap={1} flexWrap=\"wrap\" justifyContent=\"space-between\">\r\n            {weaponSheet && <LevelSelect level={level} ascension={ascension} setBoth={weaponDispatch} useLow={!weaponSheet.hasRefinement} />}\r\n            <Button color=\"error\" onClick={() => id && database.weapons.set(id, { lock: !lock })} startIcon={lock ? <Lock /> : <LockOpen />}>\r\n              {lock ? \"Locked\" : \"Unlocked\"}\r\n            </Button>\r\n          </Box>\r\n          <Typography><StarsDisplay stars={weaponSheet.rarity} /></Typography>\r\n          <Typography variant=\"subtitle1\"><strong>{weaponSheet.passiveName}</strong></Typography>\r\n          <Typography gutterBottom>{weaponSheet.passiveName && weaponSheet.passiveDescription(weaponUIData.get(input.weapon.refineIndex).value)}</Typography>\r\n          <Box display=\"flex\" flexDirection=\"column\" gap={1}>\r\n            <CardDark >\r\n              <CardHeader title={\"Main Stats\"} titleTypographyProps={{ variant: \"subtitle2\" }} />\r\n              <Divider />\r\n              <FieldDisplayList>\r\n                {[input.weapon.main, input.weapon.sub, input.weapon.sub2].map((node, i) => {\r\n                  const n = weaponUIData.get(node)\r\n                  if (n.isEmpty || !n.value) return null\r\n                  return <NodeFieldDisplay key={n.info.key} node={n} component={ListItem} />\r\n                })}\r\n              </FieldDisplayList>\r\n            </CardDark>\r\n            {data && weaponSheet.document && <DocumentDisplay sections={weaponSheet.document} />}\r\n          </Box>\r\n        </Grid>\r\n      </Grid>}\r\n    </CardContent>\r\n    {footer && id && <CardContent sx={{ py: 1 }}>\r\n      <Grid container spacing={1}>\r\n        <Grid item flexGrow={1}>\r\n          <CharacterAutocomplete showDefault size=\"small\" defaultIcon={<BusinessCenter />} defaultText={t(\"inventory\")} value={location} onChange={equipOnChar} filter={filter} disable={(v: any) => v === \"\"} disableClearable />\r\n        </Grid>\r\n        <Grid item flexGrow={2} />\r\n        {!!onClose && <Grid item><CloseButton sx={{ height: \"100%\" }} large onClick={onClose} /></Grid>}\r\n      </Grid>\r\n    </CardContent>}\r\n  </CardLight ></ModalWrapper>\r\n}\r\n"],"names":["WeaponEditor","propWeaponId","weaponId","footer","onClose","extraButtons","t","useTranslation","data","useContext","DataContext","database","DatabaseContext","weapon","useWeapon","key","level","refinement","ascension","lock","location","id","weaponSheet","usePromise","WeaponSheet","weaponDispatch","useCallback","newWeapon","weapons","set","characterSheet","CharacterSheet","undefined","initialWeaponFilter","weaponTypeKey","equipOnChar","charKey","filter","cs","weaponType","useBoolState","showModal","onShowModal","onHideModal","img","getImg","useEffect","rarity","milestoneLevelsLow","weaponUIData","useMemo","computeUIData","dataObjForWeapon","open","containerProps","maxWidth","show","onHide","onSelect","k","weaponTypeFilter","container","spacing","item","xs","sm","component","src","className","sx","width","height","borderRadius","description","display","flexDirection","gap","flexWrap","justifyContent","color","onClick","name","hasRefinement","setRefinement","r","setBoth","useLow","startIcon","stars","variant","passiveName","gutterBottom","passiveDescription","get","input","value","title","titleTypographyProps","map","node","i","n","isEmpty","ListItem","info","document","sections","py","flexGrow","showDefault","size","defaultIcon","defaultText","onChange","disable","v","disableClearable","large"],"sourceRoot":""}
import{u as K,r as o,a2 as A,a as G,b as N,E as R,dE as S,e as Z,d as J,k as e,i as l,C as W,B as r,D as Q,G as F,n as X,M as Y,ac as H,aR as ee,dD as ae,v as te,a6 as se,T as f,bM as oe,m as ne}from"./index-ae0e5ead.js";import{f as re,s as le,T as ie,l as ce,F as de,c as pe}from"./StarDisplay-3a29ee7b.js";import{g as w,Z as me,C as ue,S as I}from"./index-2c4aa6a3.js";import{c as j,E as he,o as xe,k as fe,a as ye,l as ge,p as Ce,b as ve,e as Te}from"./CharacterSort-3bb128a8.js";import{C as be}from"./CloseButton-5250fd57.js";import{W as we}from"./WeaponUtil-42644eba.js";import{D as De}from"./FieldDisplay-7b50c48c.js";import{c as z}from"./totalUtils-0230c8ad.js";import"./DropdownButton-02febc47.js";import"./ColoredText-c98c28ec.js";import"./index-d23e7aaf.js";import"./index-ab1db78b.js";import"./Help-1fa4c6a0.js";import"./SlotIcon-eec7d7dd.js";const Me=Object.keys(j);function $e({show:n,onHide:c,onSelect:d,filter:s=()=>!0,newFirst:m=!1}){const{t:y}=K(["page_character","sillyWisher_charNames","charNames_gen"]),{silly:u}=o.useContext(A),t=G(),[g,C]=o.useState(()=>t.displayCharacter.get());o.useEffect(()=>t.displayCharacter.follow((a,i)=>C(i)),[t,C]);const{gender:h}=N(),[D,v]=R();o.useEffect(()=>t.charMeta.followAny(()=>v()),[v,t]);const[T,b]=o.useState(""),M=o.useDeferredValue(T),B=o.useDeferredValue(g),E=o.useDeferredValue(D),x=o.useMemo(()=>{const{element:a,weaponType:i,sortType:p,ascending:U}=B,q=[...m?["new"]:[],...j[p]??[]];return E&&S.filter(k=>s(t.chars.get(k),w(k,h))).filter(re({element:a,weaponType:i,name:M},ve(t,u))).sort(le(q,U,Te(t,u),["new","favorite"]))},[B,m,E,M,t,u,s,h]),L=o.useMemo(()=>z(Z,a=>S.forEach(i=>{const p=w(i,t.gender).weaponTypeKey;a[p].total++,x.includes(i)&&a[p].current++})),[x,t]),_=o.useMemo(()=>z(J,a=>S.forEach(i=>{const p=w(i,t.gender).elementKey;a[p].total++,x.includes(i)&&a[p].current++})),[x,t]),{weaponType:P,element:V,sortType:$,ascending:O}=g;return e(Y,{open:n,onClose:c,sx:{"& .MuiContainer-root":{justifyContent:"normal"}},children:l(X,{children:[l(W,{sx:{py:1,display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[e(we,{sx:{height:"100%"},onChange:a=>t.displayCharacter.set({weaponType:a}),value:P,totals:L,size:"small"}),e(he,{sx:{height:"100%"},onChange:a=>t.displayCharacter.set({element:a}),value:V,totals:_,size:"small"}),e(r,{flexGrow:1,children:e(ie,{autoFocus:!0,value:T,onChange:a=>b(a.target.value),label:y("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})}),e(ce,{sx:{height:"100%"},sortKeys:Me,value:$,onChange:a=>t.displayCharacter.set({sortType:a}),ascending:O,onChangeAsc:a=>t.displayCharacter.set({ascending:a})}),e(be,{onClick:c})]}),e(Q,{}),e(De.Provider,{value:{teamData:void 0},children:e(W,{children:e(F,{container:!0,spacing:1,columns:{xs:2,sm:3,md:4,lg:5},children:x.map(a=>e(F,{item:!0,xs:1,children:e(Be,{characterKey:a,onClick:()=>{c(),d==null||d(a)}})},a))})})})]})})}const Se=H(({className:n,...c})=>e(ee,{...c,classes:{popper:n}}))({[`& .${ae.tooltip}`]:{padding:0}});function Be({characterKey:n,onClick:c}){const{gender:d}=N(),s=w(n,d),m=xe(n),{favorite:y}=fe(n),u=G(),{silly:t}=o.useContext(A),[g,C,h]=te(),{level:D=1,ascension:v=0,constellation:T=0}=m??{},b=me(n,"banner",d);return e(Se,{enterDelay:300,enterNextDelay:300,arrow:!0,placement:"bottom",open:g,onClose:h,onOpen:C,title:e(r,{sx:{width:300},children:e(ye,{hideStats:!0,characterKey:n})}),children:e(r,{children:l(ne,{sx:{flexGrow:1,display:"flex",flexDirection:"column"},children:[e(r,{sx:{position:"absolute",opacity:.7,zIndex:2},children:e(se,{sx:{p:.25},onClick:M=>{h(),u.charMeta.set(n,{favorite:!y})},children:y?e(de,{}):e(ge,{})})}),e(ue,{onClick:c,children:l(r,{display:"flex",position:"relative",className:b?void 0:`grad-${s==null?void 0:s.rarity}star`,sx:{"&::before":{content:'""',display:"block",position:"absolute",left:0,top:0,width:"100%",height:"100%",opacity:.7,backgroundImage:`url(${b})`,backgroundPosition:"center",backgroundSize:"cover"}},width:"100%",children:[e(r,{flexShrink:1,sx:{maxWidth:{xs:"33%",lg:"30%"}},alignSelf:"flex-end",display:"flex",flexDirection:"column",zIndex:1,children:e(r,{component:"img",src:Ce(n,d,t),width:"100%",height:"auto",maxWidth:256,sx:{mt:"auto"}})}),l(r,{flexGrow:1,sx:{pr:1,pt:1},display:"flex",flexDirection:"column",zIndex:1,justifyContent:"space-evenly",children:[e(f,{variant:"body2",sx:{flexGrow:1},children:e(I,{color:s==null?void 0:s.elementKey,sx:{opacity:.85,textShadow:"0 0 5px gray"},children:s==null?void 0:s.name})}),m?l(r,{sx:{display:"flex",gap:1,alignItems:"center"},children:[l(r,{sx:{textShadow:"0 0 5px gray"},children:[l(f,{variant:"body2",component:"span",whiteSpace:"nowrap",children:["Lv. ",D]}),l(f,{variant:"body2",component:"span",color:"text.secondary",children:["/",oe[v]]})]}),l(f,{variant:"body2",children:["C",T]})]}):e(f,{component:"span",variant:"body2",children:e(I,{children:"NEW"})}),e(pe,{stars:(s==null?void 0:s.rarity)??1,colored:!0})]})]})})]})})})}export{$e as default};

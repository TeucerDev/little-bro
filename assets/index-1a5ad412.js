import{a as N,a8 as j,r,a9 as ee,aa as ae,u as te,ab as re,N as se,p as ne,i as C,k as t,C as oe,G as c,B as M,n as ce,s as ie,y as W,e as le,d as he,ac as pe}from"./index-52652410.js";import{u as ue,f as me,s as de,a as ge,T as fe,S as ye,d as Ce}from"./StarDisplay-4e44c303.js";import{E as we,C as xe,a as Te,c as F,b as Se,d as be,e as ke,f as ve}from"./CharacterRarityToggle-e8beeab0.js";import{W as Ke}from"./WeaponCard-7f840d7c.js";import{g as D}from"./index-e160f5e8.js";import{g as Ee}from"./index-ddc46287.js";import{c as w}from"./totalUtils-c715a497.js";import"./DropdownButton-1f62102f.js";import"./ColoredText-fdad0407.js";import"./TeamCard-a3c6de8a.js";import"./BootstrapTooltip-0d495362.js";import"./DataContext-fba4625a.js";import"./index-40f1e0f0.js";import"./StatIcon-62880fe1.js";import"./SlotIcon-8e7ded47.js";import"./useWeapon-08ae6f71.js";import"./Close-99e9cee7.js";import"./WeaponEditor-3d67fbc5.js";import"./ConditionalWrapper-d302f5e9.js";import"./InfoTooltip-5dedc0a2.js";import"./CheckBoxOutlineBlank-7cda6282.js";import"./ArtifactSort-2dad4e9a.js";import"./ChevronRight-ac9717f9.js";import"./SolidToggleButtonGroup-3ce817a1.js";import"./WeaponSelectionModal-1547e2c3.js";import"./Settings-a790bc9f.js";function Me(){const e=N(),i=j();return r.useCallback(p=>{e.chars.get(p)||e.chars.getWithInitWeapon(p),i(`/characters/${p}`)},[i,e])}const We={xs:1,sm:2,md:3,lg:4,xl:4},De={xs:5,sm:8,md:9,lg:12,xl:12},Ne=Object.keys(F);function sa(){const e=N(),i=j(),{params:{characterKey:l}}=ee({path:"/characters/:characterKey",end:!1})??{params:{}},p=r.useMemo(()=>l?ae(l)?(e.chars.get(l)||e.chars.getWithInitWeapon(l),l):(i("/characters"),null):null,[l,i,e]),{t:u}=te(["page_character","sillyWisher_charNames","charNames_gen"]),{silly:g}=r.useContext(re),[x,T]=r.useState(()=>e.displayCharacter.get());r.useEffect(()=>e.displayCharacter.follow((a,n)=>T(n)),[e,T]);const[S,I]=r.useState(""),b=r.useDeferredValue(S),_=ue(),[A,k]=r.useState(!1),[B,m]=se();r.useEffect(()=>(ne.send({hitType:"pageview",page:"/characters"}),e.chars.followAny((a,n)=>(n==="new"||n==="remove")&&m())),[m,e]),r.useEffect(()=>e.charMeta.followAny(a=>m()),[m,e]);const O=Me(),v=r.useDeferredValue(x),K=r.useDeferredValue(B),{charKeys:s,totalCharNum:f}=r.useMemo(()=>{const n=e.chars.keys.length,{element:h,weaponType:o,rarity:d,sortType:X,ascending:Y}=v,Z=e.chars.keys.filter(me({element:h,weaponType:o,rarity:d,name:b},Se(e,g))).sort(de(F[X]??[],Y,be(e,g),["new","favorite"]));return K&&{charKeys:Z,totalCharNum:n}},[e,v,b,g,K]),{weaponType:P,element:R,rarity:$,sortType:z,ascending:G}=x,U=r.useMemo(()=>w(le,a=>Object.entries(e.chars.data).forEach(([n,h])=>{const o=e.weapons.get(h.equippedWeapon);if(!o)return;const d=Ee(o.key).weaponType;a[d].total++,s.includes(n)&&a[d].current++})),[e,s]),V=r.useMemo(()=>w(he,a=>Object.entries(e.chars.data).forEach(([n,h])=>{const o=D(h.key,e.gender).elementKey;a[o].total++,s.includes(n)&&a[o].current++})),[e,s]),H=r.useMemo(()=>w(pe,a=>Object.entries(e.chars.data).forEach(([n,h])=>{const o=D(h.key,e.gender).rarity;a[o].total++,s.includes(n)&&a[o].current++})),[e,s]),{numShow:E,setTriggerElement:q}=ge(De[_],s.length),y=r.useMemo(()=>s.slice(0,E),[s,E]),Q=s.length!==f?`${s.length}/${f}`:`${f}`,J={numShowing:y.length,total:Q,t:u,namespace:"page_character"},L={sortKeys:[...Ne],value:z,onChange:a=>e.displayCharacter.set({sortType:a}),ascending:G,onChangeAsc:a=>e.displayCharacter.set({ascending:a})};return C(M,{my:1,display:"flex",flexDirection:"column",gap:1,children:[p&&t(ke,{characterKey:p,onClose:()=>i("/characters")}),t(r.Suspense,{fallback:!1,children:t(ve,{newFirst:!0,show:A,onHide:()=>k(!1),onSelect:O})}),t(ce,{children:C(oe,{sx:{display:"flex",flexDirection:"column",gap:1},children:[C(c,{container:!0,spacing:1,children:[t(c,{item:!0,children:t(Ke,{sx:{height:"100%"},onChange:a=>e.displayCharacter.set({weaponType:a}),value:P,totals:U,size:"small"})}),t(c,{item:!0,children:t(we,{sx:{height:"100%"},onChange:a=>e.displayCharacter.set({element:a}),value:R,totals:V,size:"small"})}),t(c,{item:!0,children:t(xe,{sx:{height:"100%"},onChange:a=>e.displayCharacter.set({rarity:a}),value:$,totals:H,size:"small"})}),t(c,{item:!0,flexGrow:1}),t(c,{item:!0,children:t(fe,{autoFocus:!0,value:S,onChange:a=>I(a.target.value),label:u("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})})]}),t(M,{display:"flex",justifyContent:"space-between",alignItems:"flex-end",flexWrap:"wrap",children:t(ye,{showingTextProps:J,sortByButtonProps:L})})]})}),t(ie,{fullWidth:!0,onClick:()=>k(!0),color:"info",startIcon:t(Ce,{}),children:u`addNew`}),t(r.Suspense,{fallback:t(W,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:t(c,{container:!0,spacing:1,columns:We,children:y.map(a=>t(c,{item:!0,xs:1,children:t(Te,{characterKey:a,onClick:()=>i(`${a}`),hideStats:!0})},a))})}),s.length!==y.length&&t(W,{ref:a=>{a&&q(a)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{sa as default};

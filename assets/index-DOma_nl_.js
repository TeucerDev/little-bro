import{v as j,a as R,r as t,aV as P,aW as ce,b as e,d as l,G as h,T as U,a2 as T,ac as ie,ab as b,f as B,al as F,J as H,aX as V,aY as re,aZ as de,a_ as pe,a$ as ue,ag as Q,ah as X,M as N,b0 as he,b1 as me,B as fe,b2 as ge,K as Y,h as Z,b3 as ye,A as O,z as we,b4 as We,af as ke,ae as L,b5 as be,ai as xe,$ as Te,as as Se,b6 as Ce,av as ve,aw as Ie,ax as qe,b7 as Ee,aB as $e,ay as De,b8 as Ke,b9 as ee,ba as _e,bb as Be,bc as Me,bd as ze,S as J}from"./index-Bw7_NbGr.js";const oe=["locked","unlocked"],Ae=ye([...oe]);function Fe({numShowing:u,total:o,weaponIds:i}){const{t:d}=j(["page_weapon","ui"]),a=R(),[y,I]=t.useState(a.displayWeapon.get());t.useEffect(()=>{a.displayWeapon.follow((s,r)=>I(r))},[a]);const{weaponType:q,rarity:D,locked:p,showEquipped:c,showInventory:S,locations:E}=y,w=t.useMemo(()=>P(we,s=>a.weapons.entries.forEach(([r,k])=>{const f=O(k.key).weaponType;s[f].total++,i.includes(r)&&s[f].current++})),[a,i]),W=t.useMemo(()=>P(We,s=>a.weapons.entries.forEach(([r,k])=>{const f=O(k.key).rarity;s[f].total++,i.includes(r)&&s[f].current++})),[a,i]),{lockedTotal:$,equippedTotal:C,locationTotal:K}=t.useMemo(()=>{const s={lockedTotal:["locked","unlocked"],equippedTotal:["equipped","unequipped"],locationTotal:[...be,""]};return ce(s,r=>a.weapons.entries.forEach(([k,f])=>{const v=f.location,m=f.lock?"locked":"unlocked",x=v?"equipped":"unequipped";r.lockedTotal[m].total++,r.equippedTotal[x].total++,r.locationTotal[v].total++,i.includes(k)&&(r.lockedTotal[m].current++,r.equippedTotal[x].current++,r.locationTotal[v].current++)}))},[a,i]);return e(Z,{children:l(Y,{sx:{display:"flex",flexDirection:"column",gap:1},children:[l(h,{container:!0,children:[e(h,{item:!0,children:e(U,{variant:"h6",children:d`weaponFilterTitle`})}),e(h,{item:!0,flexGrow:1,display:"flex",justifyContent:"center",alignItems:"center",children:l(U,{children:[e("strong",{children:u})," / ",o]})}),e(h,{item:!0,children:e(T,{size:"small",color:"error",onClick:()=>a.displayWeapon.set({action:"reset"}),startIcon:e(ie,{}),children:e(b,{t:d,i18nKey:"ui:reset"})})})]}),e(B,{children:l(h,{container:!0,spacing:1,children:[l(h,{item:!0,xs:12,md:6,display:"flex",flexDirection:"column",children:[e(b,{t:d,i18nKey:"subheadings.general"}),l(F,{spacing:1,children:[e(H,{sx:{bgcolor:V.palette.contentNormal.light}}),e(re,{fullWidth:!0,onChange:s=>a.displayWeapon.set({weaponType:s}),value:q,totals:w,size:"small"}),e(de,{sx:{height:"100%"},fullWidth:!0,onChange:s=>a.displayWeapon.set({rarity:s}),value:D,totals:W,size:"small"})]})]}),e(h,{item:!0,xs:12,md:6,display:"flex",flexDirection:"column",gap:1,children:l(B,{children:[e(b,{t:d,i18nKey:"subheadings.inventory"}),l(F,{spacing:1,children:[e(H,{sx:{bgcolor:V.palette.contentNormal.light}}),e(pe,{fullWidth:!0,value:p,size:"small",children:oe.map((s,r)=>l(ue,{value:s,sx:{display:"flex",gap:1},onClick:()=>a.displayWeapon.set({locked:Ae(p,s)}),children:[r?e(Q,{}):e(X,{}),e(b,{t:d,i18nKey:`ui:${s}`}),e(N,{label:$[r?"unlocked":"locked"],size:"small"})]},s))}),l(T,{startIcon:e(he,{}),color:S?"success":"secondary",onClick:()=>a.displayWeapon.set({showInventory:!S}),children:[d`weaponInInv`," ",e(N,{sx:{ml:1},label:C.unequipped,size:"small"})]}),l(T,{startIcon:e(me,{}),color:c?"success":"secondary",onClick:()=>a.displayWeapon.set({showEquipped:!c}),children:[d`equippedWeapon`," ",e(N,{sx:{ml:1},label:C.equipped,size:"small"})]})]}),e(F,{spacing:1.5,pt:1.5,children:e(t.Suspense,{fallback:null,children:e(fe,{title:c?d`locationsTooltip`:"",placement:"top",children:e("span",{children:e(ge,{totals:K,locations:c?[]:E,setLocations:s=>a.displayWeapon.set({locations:s}),disabled:c})})})})})]})})]})})]})})}function Ne({weaponIds:u}){const{t:o}=j(["page_weapon","ui"]),i=R(),{numDelete:d,numUnlock:a,numLock:y}=t.useMemo(()=>{const p=u.map(w=>i.weapons.get(w)),c=p.reduce((w,W)=>w+(W.lock?0:1),0),S=p.length-c;return{numDelete:p.reduce((w,W)=>w+(W.lock||W.location?0:1),0),numUnlock:c,numLock:S}},[u,i]);return l(h,{container:!0,spacing:1,alignItems:"center",children:[e(h,{item:!0,xs:16,sm:8,md:4,children:l(T,{fullWidth:!0,color:"error",disabled:!d,onClick:()=>window.confirm(`Are you sure you want to delete ${d} weapons?`)&&u.map(p=>{const c=i.weapons.get(p);!(c!=null&&c.lock)&&!(c!=null&&c.location)&&i.weapons.remove(p)}),startIcon:e(ke,{}),children:[e(b,{t:o,i18nKey:"button.deleteWeapons",children:"Delete Weapons"}),e(L,{sx:{ml:1},color:d?"success":"secondary",children:d})]})}),e(h,{item:!0,xs:16,sm:8,md:4,children:l(T,{fullWidth:!0,color:"error",disabled:!y,onClick:()=>window.confirm(`Are you sure you want to unlock ${y} weapons ?`)&&u.map(p=>i.weapons.set(p,{lock:!1})),startIcon:e(Q,{}),children:[e(b,{t:o,i18nKey:"button.unlockWeapons",children:"Unlock Weapons"}),e(L,{sx:{ml:1},color:y?"success":"secondary",children:y})]})}),e(h,{item:!0,xs:16,sm:8,md:4,children:l(T,{fullWidth:!0,color:"error",disabled:!a,onClick:()=>window.confirm(`Are you sure you want to lock ${a} weapons ?`)&&u.map(p=>i.weapons.set(p,{lock:!0})),startIcon:e(X,{}),children:[e(b,{t:o,i18nKey:"button.lockWeapons",children:"Lock Weapons"}),e(L,{sx:{ml:1},color:a?"success":"secondary",children:a})]})}),e(h,{item:!0,xs:12,display:"flex",justifyContent:"space-around",children:e(U,{variant:"caption",color:"text.secondary",children:l(b,{t:o,i18nKey:"buttonHint",children:["Note: the red buttons above only apply to",e("b",{children:"currently filtered weapons"})]})})})]})}const Le={xs:1,sm:2,md:3,lg:3,xl:4},Ue={xs:10,sm:12,md:24,lg:24,xl:24},je=Object.keys(ee);function Ge(){const{t:u}=j(["page_weapon","ui","weaponNames_gen"]),o=R(),[i,d]=t.useState(o.displayWeapon.get());t.useEffect(()=>o.displayWeapon.follow((n,g)=>d(g)),[o]);const[a,y]=t.useState(!1),[I,q]=xe();t.useEffect(()=>(Te.send({hitType:"pageview",page:"/weapon"}),o.weapons.followAny((n,g)=>(g==="new"||g==="remove"||g==="update")&&q())),[q,o]);const D=Se(),p=t.useCallback(async n=>{const g=o.weapons.get(n);if(!g)return;const A=u(`weaponNames_gen:${g.key}`);window.confirm(u("removeWeapon",{value:A}))&&(o.weapons.remove(n),i.editWeaponId===n&&o.displayWeapon.set({editWeaponId:""}))},[i.editWeaponId,o,u]),c=t.useCallback(n=>{o.displayWeapon.set({editWeaponId:n})},[o]),S=t.useCallback(n=>{c(o.weapons.new(Ce(n)))},[o,c]),[E,w]=t.useState(""),W=t.useDeferredValue(E),{sortType:$,ascending:C,weaponType:K,rarity:s,locked:r,showEquipped:k,showInventory:f,locations:v}=i,{weaponIds:m,totalWeaponNum:x}=t.useMemo(()=>{const n=o.weapons.values,g=n.length,A=n.filter(ve({weaponType:K,rarity:s,name:W,locked:r,showInventory:f,showEquipped:k,locations:v},_e())).sort(Ie(ee[$]??[],C,Be())).map(le=>le.id);return I&&{weaponIds:A,totalWeaponNum:g}},[I,o,$,C,s,K,r,f,k,v,W]),{numShow:G,setTriggerElement:ne}=qe(Ue[D],m.length),M=t.useMemo(()=>m.slice(0,G),[m,G]),ae=m.length!==x?`${m.length}/${x}`:`${x}`,z=t.useCallback(()=>o.displayWeapon.set({editWeaponId:""}),[o]),{editWeaponId:_}=i;t.useEffect(()=>{_&&(o.weapons.get(_)||z())},[o,_,z]);const te={numShowing:M.length,total:ae,t:u,namespace:"page_weapon"},se={sortKeys:[...je],value:$,onChange:n=>o.displayWeapon.set({sortType:n}),ascending:C,onChangeAsc:n=>o.displayWeapon.set({ascending:n})};return l(B,{display:"flex",flexDirection:"column",gap:1,children:[e(t.Suspense,{fallback:!1,children:e(Me,{show:a,onHide:()=>y(!1),onSelect:S})}),e(t.Suspense,{fallback:!1,children:e(ze,{weaponId:_,footer:!0,onClose:z})}),e(Fe,{numShowing:m.length,total:x,weaponIds:m}),e(Z,{children:l(Y,{sx:{display:"flex",flexDirection:"column",gap:1},children:[l(B,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",children:[e(Ee,{autoFocus:!0,size:"small",value:E,onChange:n=>w(n.target.value),label:u("weaponName"),sx:{height:"100%"},InputProps:{sx:{height:"100%"}}}),e($e,{showingTextProps:te,sortByButtonProps:se})]}),e(Ne,{weaponIds:m})]})}),l(t.Suspense,{fallback:e(J,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:500}}),children:[e(T,{fullWidth:!0,onClick:()=>y(!0),color:"info",startIcon:e(De,{}),children:u("page_weapon:addWeapon")}),e(h,{container:!0,spacing:1,columns:Le,children:M.map(n=>e(h,{item:!0,xs:1,children:e(Ke,{weaponId:n,onDelete:p,onEdit:c,canEquip:!0})},n))})]}),m.length!==M.length&&e(J,{ref:n=>{n&&ne(n)},sx:{borderRadius:1},variant:"rectangular",width:"100%",height:100})]})}export{Ge as default};

import{u as pe,r as s,a2 as de,a as ue,E as me,p as fe,b as ge,a3 as ye,a4 as Ce,i as h,k as e,C as B,G as i,B as x,n as G,w as K,x as xe,a5 as we,D as z,T as u,a6 as m,K as Te,_ as Se,N as be,e as ke,d as ve,a7 as De}from"./index-ae0e5ead.js";import{u as Pe,f as _e,s as Ee,T as Ie,P as L}from"./StarDisplay-3a29ee7b.js";import{u as Me,E as Ne,C as Fe,d as R,a as We,F as je,T as $e,S as Be,D as Ge,c as A,b as Ke,e as ze}from"./CharacterSort-3bb128a8.js";import{B as f}from"./Help-1fa4c6a0.js";import{W as Le}from"./WeaponUtil-42644eba.js";import{g as k}from"./index-2c4aa6a3.js";import{g as Re}from"./index-ab1db78b.js";import{c as v}from"./totalUtils-0230c8ad.js";import{G as Ae}from"./FieldDisplay-7b50c48c.js";import"./DropdownButton-02febc47.js";import"./ColoredText-c98c28ec.js";import"./index-d23e7aaf.js";import"./SlotIcon-eec7d7dd.js";const Oe=Te.lazy(()=>Se(()=>import("./CharacterSelectionModal-4994de0f.js"),["./CharacterSelectionModal-4994de0f.js","./index-ae0e5ead.js","./index-11aa491f.css","./StarDisplay-3a29ee7b.js","./DropdownButton-02febc47.js","./ColoredText-c98c28ec.js","./index-2c4aa6a3.js","./CharacterSort-3bb128a8.js","./FieldDisplay-7b50c48c.js","./Help-1fa4c6a0.js","./index-d23e7aaf.js","./index-ab1db78b.js","./WeaponUtil-42644eba.js","./SlotIcon-eec7d7dd.js","./CloseButton-5250fd57.js","./totalUtils-0230c8ad.js"],import.meta.url)),Ve={xs:1,sm:2,md:3,lg:4,xl:4},Ue={xs:6,sm:8,md:12,lg:16,xl:16},He=Object.keys(A);function lt(){const{t:n}=pe(["page_character","sillyWisher_charNames","charNames_gen"]),{silly:p}=s.useContext(de),a=ue(),[D,P]=s.useState(()=>a.displayCharacter.get());s.useEffect(()=>a.displayCharacter.follow((t,r)=>P(r)),[a,P]);const[_,O]=s.useState(""),E=s.useDeferredValue(_),w=s.useRef(null),V=s.useCallback((t,r)=>{var l;(l=w.current)==null||l.scrollIntoView({behavior:"smooth"}),a.displayCharacter.set({pageIndex:r-1})},[a,w]),U=Pe(),g=Ue[U],[H,T]=s.useState(!1),[q,y]=me();s.useEffect(()=>(fe.send({hitType:"pageview",page:"/characters"}),a.chars.followAny((t,r)=>(r==="new"||r==="remove")&&y())),[y,a]),s.useEffect(()=>a.charMeta.followAny(t=>y()),[y,a]);const{gender:S}=ge(),Q=s.useCallback(async t=>{let r=k(t,S).name;typeof r=="object"&&(r=n(`${p?"sillyWisher_charNames":"charNames_gen"}:${ye(t,S)}`)),window.confirm(n("removeCharacter",{value:r}))&&a.chars.remove(t)},[a.chars,S,p,n]),J=Me(),d=Ce(),I=s.useDeferredValue(D),M=s.useDeferredValue(q),{charKeyList:o,totalCharNum:b}=s.useMemo(()=>{const r=a.chars.keys.length,{element:l,weaponType:c,rarity:C,sortType:ce,ascending:ie}=I,he=a.chars.keys.filter(_e({element:l,weaponType:c,rarity:C,name:E},Ke(a,p))).sort(Ee(A[ce]??[],ie,ze(a,p),["new","favorite"]));return M&&{charKeyList:he,totalCharNum:r}},[a,I,E,p,M]),{weaponType:X,element:Y,rarity:Z,sortType:ee,ascending:te,pageIndex:N=0}=D,{charKeyListToShow:F,numPages:W,currentPageIndex:ae}=s.useMemo(()=>{const t=Math.ceil(o.length/g),r=be(N,0,t-1);return{charKeyListToShow:o.slice(r*g,(r+1)*g),numPages:t,currentPageIndex:r}},[o,N,g]),re=o.length!==b?`${o.length}/${b}`:`${b}`,se=s.useMemo(()=>v(ke,t=>Object.entries(a.chars.data).forEach(([r,l])=>{const c=a.weapons.get(l.equippedWeapon);if(!c)return;const C=Re(c.key).weaponType;t[C].total++,o.includes(r)&&t[C].current++})),[a,o]),ne=s.useMemo(()=>v(ve,t=>Object.entries(a.chars.data).forEach(([r,l])=>{const c=k(l.key,a.gender).elementKey;t[c].total++,o.includes(r)&&t[c].current++})),[a,o]),oe=s.useMemo(()=>v(De,t=>Object.entries(a.chars.data).forEach(([r,l])=>{const c=k(l.key,a.gender).rarity;t[c].total++,o.includes(r)&&t[c].current++})),[a,o]),j={count:W,page:ae+1,onChange:V},$={numShowing:F.length,total:re,t:n,namespace:"page_character"},le={sortKeys:[...He],value:ee,onChange:t=>a.displayCharacter.set({sortType:t}),ascending:te,onChangeAsc:t=>a.displayCharacter.set({ascending:t})};return h(x,{my:1,display:"flex",flexDirection:"column",gap:1,children:[e(s.Suspense,{fallback:!1,children:e(Oe,{newFirst:!0,show:H,onHide:()=>T(!1),onSelect:J})}),e(G,{ref:w,children:h(B,{sx:{display:"flex",flexDirection:"column",gap:1},children:[h(i,{container:!0,spacing:1,children:[e(i,{item:!0,children:e(Le,{sx:{height:"100%"},onChange:t=>a.displayCharacter.set({weaponType:t}),value:X,totals:se,size:"small"})}),e(i,{item:!0,children:e(Ne,{sx:{height:"100%"},onChange:t=>a.displayCharacter.set({element:t}),value:Y,totals:ne,size:"small"})}),e(i,{item:!0,children:e(Fe,{sx:{height:"100%"},onChange:t=>a.displayCharacter.set({rarity:t}),value:Z,totals:oe,size:"small"})}),e(i,{item:!0,flexGrow:1}),e(i,{item:!0,children:e(Ie,{autoFocus:!0,value:_,onChange:t=>O(t.target.value),label:n("characterName"),size:"small",sx:{height:"100%"},InputProps:{sx:{height:"100%"}}})})]}),e(x,{display:"flex",justifyContent:"space-between",alignItems:"flex-end",flexWrap:"wrap",children:e(L,{paginationProps:j,showingTextProps:$,displaySort:!0,sortByButtonProps:le})})]})}),e(K,{fullWidth:!0,onClick:()=>T(!0),color:"info",startIcon:e(R,{}),children:n`addNew`}),e(s.Suspense,{fallback:e(xe,{variant:"rectangular",sx:{width:"100%",height:"100%",minHeight:5e3}}),children:e(i,{container:!0,spacing:1,columns:Ve,children:F.map(t=>e(i,{item:!0,xs:1,children:e(We,{characterKey:t,onClick:()=>d(`${t}`),footer:h(we,{children:[e(z,{}),h(x,{sx:{py:1,px:2,display:"flex",gap:1,justifyContent:"space-between"},children:[e(f,{placement:"top",title:e(u,{children:n("tabs.talent")}),children:e(m,{onClick:()=>d(`${t}/talent`),children:e(je,{})})}),e(f,{placement:"top",title:e(u,{children:n("tabs.teambuffs")}),children:e(m,{onClick:()=>d(`${t}/teambuffs`),children:e(Ae,{})})}),e(f,{placement:"top",title:e(u,{children:n("tabs.optimize")}),children:e(m,{onClick:()=>d(`${t}/optimize`),children:e($e,{})})}),e(f,{placement:"top",title:e(u,{children:n("tabs.theorycraft")}),children:e(m,{onClick:()=>d(`${t}/theorycraft`),children:e(Be,{})})}),e(z,{orientation:"vertical"}),e(f,{placement:"top",title:e(u,{children:n("delete")}),children:e(m,{color:"error",onClick:()=>Q(t),children:e(Ge,{})})})]})]})})},t))})}),W>1&&e(G,{children:h(B,{sx:{display:"flex",flexDirection:"row",gap:1},children:[e(K,{onClick:()=>T(!0),color:"info",sx:{minWidth:0},children:e(R,{})}),e(x,{display:"flex",justifyContent:"space-between",alignItems:"center",flexWrap:"wrap",flexGrow:1,children:e(L,{paginationProps:j,showingTextProps:$})})]})})]})}export{lt as default};

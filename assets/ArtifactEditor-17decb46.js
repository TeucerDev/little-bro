import{aa as Qt,ab as Jt,db as Tt,ac as Ie,ap as Oe,ad as Ae,dc as Et,r as M,ae as Zt,ah as Xt,j as we,aj as er,ak as tr,k as n,dd as Pt,c as Ot,N as ne,de as Se,o as rr,c8 as Ue,df as nr,cb as sr,f as Je,by as Ge,bb as he,dg as or,bo as ar,i as x,bC as Le,a5 as ie,bc as $e,b5 as ir,dh as _e,bn as cr,J as Ze,cn as lr,u as Xe,bH as ze,bG as We,D as He,G as I,T as B,y as et,m as $t,aY as dr,c6 as ur,di as hr,O as fr,Q as pr,w as re,B as ee,bA as mr,C as be,H as Dt,n as gr,M as tt,bf as yr,dj as br,a as vr,E as wr,dk as Sr,g as Cr,h as xr,aX as kr,aQ as Lr,bB as ce,x as lt,ba as Ar,b7 as Rr,dl as Tr,I as Er}from"./index-ae0e5ead.js";import{q as qe,S as dt,r as Pr}from"./index-2c4aa6a3.js";import{d as Or}from"./Help-1fa4c6a0.js";import{P as Mt,k as Ye,l as $r,a as Dr,d as Mr,A as ut}from"./StatEditorList-5845ef79.js";import{R as It,A as Ir,a as _r,C as Nr}from"./ArtifactRarityDropdown-eb66d942.js";import{M as Re,D as rt}from"./DropdownButton-02febc47.js";import{S as ht}from"./SlotIcon-eec7d7dd.js";import{b as Kr,A as ft}from"./LocationAutocomplete-98591767.js";import{C as Ve}from"./CloseButton-5250fd57.js";import{T as jr}from"./StarDisplay-3a29ee7b.js";import{B as _t,I as Fr}from"./ColoredText-c98c28ec.js";import{g as pt,A as Br}from"./index-d23e7aaf.js";import{I as Ur}from"./InfoTooltip-b155e42f.js";import{T as Gr}from"./TextButton-0795b148.js";import{S as zr}from"./sortByRarityAndName-c5d0cb85.js";import{C as Wr}from"./CardHeader-17934b00.js";import"./Link-9987d9fe.js";class Hr{constructor(t,r){this.data={},this.init=t,this.deinit=r}async borrow(t,r){this.data[t]||(this.data[t]={value:this.init(t),refCount:0});const s=this.data[t];s.refCount+=1;const a=await r(s.value);return s.refCount-=1,s.refCount||(delete this.data[t],this.deinit(t,s.value)),a}}function qr(e){return Qt("MuiCircularProgress",e)}Jt("MuiCircularProgress",["root","determinate","indeterminate","colorPrimary","colorSecondary","svg","circle","circleDeterminate","circleIndeterminate","circleDisableShrink"]);const Yr=["className","color","disableShrink","size","style","thickness","value","variant"];let Ne=e=>e,mt,gt,yt,bt;const ue=44,Vr=Tt(mt||(mt=Ne`
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
`)),Qr=Tt(gt||(gt=Ne`
  0% {
    stroke-dasharray: 1px, 200px;
    stroke-dashoffset: 0;
  }

  50% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -15px;
  }

  100% {
    stroke-dasharray: 100px, 200px;
    stroke-dashoffset: -125px;
  }
`)),Jr=e=>{const{classes:t,variant:r,color:s,disableShrink:a}=e,l={root:["root",r,`color${Oe(s)}`],svg:["svg"],circle:["circle",`circle${Oe(r)}`,a&&"circleDisableShrink"]};return tr(l,qr,t)},Zr=Ie("span",{name:"MuiCircularProgress",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[r.variant],t[`color${Oe(r.color)}`]]}})(({ownerState:e,theme:t})=>Ae({display:"inline-block"},e.variant==="determinate"&&{transition:t.transitions.create("transform")},e.color!=="inherit"&&{color:(t.vars||t).palette[e.color].main}),({ownerState:e})=>e.variant==="indeterminate"&&Et(yt||(yt=Ne`
      animation: ${0} 1.4s linear infinite;
    `),Vr)),Xr=Ie("svg",{name:"MuiCircularProgress",slot:"Svg",overridesResolver:(e,t)=>t.svg})({display:"block"}),en=Ie("circle",{name:"MuiCircularProgress",slot:"Circle",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.circle,t[`circle${Oe(r.variant)}`],r.disableShrink&&t.circleDisableShrink]}})(({ownerState:e,theme:t})=>Ae({stroke:"currentColor"},e.variant==="determinate"&&{transition:t.transitions.create("stroke-dashoffset")},e.variant==="indeterminate"&&{strokeDasharray:"80px, 200px",strokeDashoffset:0}),({ownerState:e})=>e.variant==="indeterminate"&&!e.disableShrink&&Et(bt||(bt=Ne`
      animation: ${0} 1.4s ease-in-out infinite;
    `),Qr)),tn=M.forwardRef(function(t,r){const s=Zt({props:t,name:"MuiCircularProgress"}),{className:a,color:l="primary",disableShrink:o=!1,size:h=40,style:f,thickness:v=3.6,value:S=0,variant:C="indeterminate"}=s,A=Xt(s,Yr),E=Ae({},s,{color:l,disableShrink:o,size:h,thickness:v,value:S,variant:C}),L=Jr(E),i={},R={},U={};if(C==="determinate"){const b=2*Math.PI*((ue-v)/2);i.strokeDasharray=b.toFixed(3),U["aria-valuenow"]=Math.round(S),i.strokeDashoffset=`${((100-S)/100*b).toFixed(3)}px`,R.transform="rotate(-90deg)"}return we.jsx(Zr,Ae({className:er(L.root,a),style:Ae({width:h,height:h},R,f),ownerState:E,ref:r,role:"progressbar"},U,A,{children:we.jsx(Xr,{className:L.svg,ownerState:E,viewBox:`${ue/2} ${ue/2} ${ue} ${ue}`,children:we.jsx(en,{className:L.circle,style:i,ownerState:E,cx:ue,cy:ue,r:(ue-v)/2,fill:"none",strokeWidth:v})})}))}),rn=tn;function nn({setKey:e}){return n(Pt,{ns:"artifactNames_gen",key18:e})}function sn({slotKey:e}){return n(Pt,{ns:"artifact",key18:`slotName.${e}`})}const on=Ot([we.jsx("circle",{cx:"12",cy:"12",r:"3.2"},"0"),we.jsx("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"},"1")],"PhotoCamera"),an=Ot(we.jsx("path",{d:"M21 10.12h-6.78l2.74-2.82c-2.73-2.7-7.15-2.8-9.88-.1-2.73 2.71-2.73 7.08 0 9.79s7.15 2.71 9.88 0C18.32 15.65 19 14.08 19 12.1h2c0 1.98-.88 4.55-2.64 6.29-3.51 3.48-9.21 3.48-12.72 0-3.5-3.47-3.53-9.11-.02-12.58s9.14-3.47 12.65 0L21 3v7.12zM12.5 8v4.25l3.5 2.08-.72 1.21L11 13V8h1.5z"}),"Update");function le(e,t=10){return Nt(e,t)}function de(e,t=10){return Nt(e,-t)}function Nt(e,t=10){const{r,g:s,b:a,a:l}=e;return{r:ne(r+t,0,255),g:ne(s+t,0,255),b:ne(a+t,0,255),a:l}}function Kt(e,t,r){return Se(e.r,t.r,r.r)&&Se(e.g,t.g,r.g)&&Se(e.b,t.b,r.b)}function fe(e,t){const r=e.width,s=e.height;let{x1:a=0,x2:l=r,y1:o=0,y2:h=s}=t;return a=ne(a,0,r),l=ne(l,0,r),o=ne(o,0,s),h=ne(h,0,s),o>=h&&(console.warn(`trying to crop with y1:${o} y2:${h}, with src height ${s}.`),o=0,h=s),a>=l&&(console.warn(`trying to crop with x1:${a} x2:${l}, with src width ${r}.`),a=0,l=r),e.getContext("2d",{willReadFrequently:!0}).getImageData(a,o,l-a,h-o)}const cn=e=>new Promise(t=>{const r=new FileReader;r.onloadend=({target:s})=>t(s.result),r.readAsDataURL(e)}),ln=e=>new Promise(t=>{const r=new Image;r.onload=({target:s})=>t(dn(s)),r.src=e});function dn(e){const t=document.createElement("canvas"),r=t.getContext("2d",{willReadFrequently:!0});return t.width=e.width,t.height=e.height,r.drawImage(e,0,0,e.width,e.height),r.getImageData(0,0,e.width,e.height)}function Y(e){const t=document.createElement("canvas");return t.width=e.width,t.height=e.height,t.getContext("2d").putImageData(e,0,0),t}function me(e,t,r,s=!0){const a=e.width,l=e.height,o=e.getContext("2d");return o.fillStyle=`rgba(${r.r},${r.g},${r.b},${r.a?r.a/255:1})`,s?o.fillRect(t,0,1,l):o.fillRect(0,t,a,1),e}function ge(e,t,r,s=!0){const a=e.getContext("2d");return a&&(a.fillStyle=`rgba(${r.r},${r.g},${r.b},${r.a?r.a/255:1})`,t.forEach((l,o)=>s?a.fillRect(o,0,1,l):a.fillRect(0,o,l,1))),e}function je(e,t,r,s="color"){const a=Uint8ClampedArray.from(e.data),l=s==="bw",o=s==="invert";for(let h=0;h<a.length;h+=4){const f=a[h],v=a[h+1],S=a[h+2];Kt({r:f,g:v,b:S},t,r)?l?a[h]=a[h+1]=a[h+2]=0:o&&(a[h]=255-f,a[h+1]=255-v,a[h+2]=255-S):a[h]=a[h+1]=a[h+2]=255}return new ImageData(a,e.width,e.height)}function Fe(e,t,r,s=!0){const a=e.height,l=e.width,o=e.data;return Array.from({length:s?l:a},(h,f)=>{let v=0;for(let S=0;S<(s?a:l);S++){const C=s?De(f,S,l):De(S,f,l),[A,E,L]=[o[C],o[C+1],o[C+2]];Kt({r:A,g:E,b:L},t,r)&&v++}return v})}function Ce(e,t,r,s=!0,a=[0,1]){const l=e.height,o=e.width,h=e.data,f=s?o:l,[v,S]=a,C=f*v,A=f*S;return Array.from({length:f},(E,L)=>{if(L<C||L>A)return 0;let i=0,R=0;for(let U=0;U<(s?l:o);U++){const b=s?De(L,U,o):De(U,L,o),[N,K,D]=[h[b],h[b+1],h[b+2]];Se(N,t.r,r.r)&&Se(K,t.g,r.g)&&Se(D,t.b,r.b)?R++:(R>i&&(i=R),R=0)}return R>i&&(i=R),i})}function De(e,t,r){return t*(r*4)+e*4}function ye(e,t=.7,r=3){const a=Math.max(...e)*t,l=e.length;let o=-r;for(let f=0;f<l;f++){const v=e[f]>a;if(!v)o=-r;else if(v&&o<0)o=f;else if(v&&f-o>r)break}o<0&&(o=0);let h=l-1+r;for(let f=l-1;f>=0;f--){const v=e[f]>a;if(!v)h=l-1+r;else if(v&&h>l-1)h=f;else if(v&&h-f>r)break}return h>l-1&&(h=l-1),[o,h]}const un={r:145,g:81,b:40},hn={r:188,g:104,b:50},fn={r:121,g:67,b:167},pn={r:160,g:86,b:224},mn={r:62,g:96,b:149},gn={r:81,g:127,b:204},Me={r:235,g:228,b:216},vt={r:255,g:231,b:186},Te={r:93,g:178,b:87},wt={r:255,g:137,b:117},Ee={r:255,g:204,b:50},yn={r:131,g:131,b:130},bn={r:74,g:81,b:102},vn={physical:"Physical",anemo:"Anemo",geo:"Geo",electro:"Electro",hydro:"Hydro",pyro:"Pyro",cryo:"Cryo",dendro:"Dendro"},xe={hp:"HP",hp_:"HP",atk:"ATK",atk_:"ATK",def:"DEF",def_:"DEF",eleMas:"Elemental Mastery",enerRech_:"Energy Recharge",critRate_:"Crit Rate",critDMG_:"Crit DMG",heal_:"Healing Bonus"};Object.entries(vn).forEach(([e,t])=>{xe[`${e}_dmg_`]=`${t} DMG Bonus`});const wn={flower:"Flower of Life",plume:"Plume of Death",sands:"Sands of Eon",goblet:"Goblet of Eonothem",circlet:"Circlet of Logos"};function Sn(e,t,r,s,a,l,o,h=!1){const f={lock:b(h,"Lock",y=>y?"Locked":"Unlocked")};o&&(f.location=b(o,"Location",y=>y));const v=t.size?[...t]:["EmblemOfSeveredFate"];let S=-1,C=[{setKey:"EmblemOfSeveredFate",rarity:5,level:0,slotKey:"flower",mainStatKey:"hp",substats:[],location:o??"",lock:h}];const A=rr(sr,y=>{let T=0;if(t.size){const P=[...t].reduce((j,F)=>j+(Ue.art.data[F].rarities.includes(y)?1:0),0);T+=P/t.size}if(e.has(y)&&T++,s.length){const P=s.reduce((j,F)=>j+(nr(F.key,F.value,y).length?1:0),0);T+=P/s.length*2}return T});for(const y of Je)for(const T of Ge[y]){const P=he(T),j=P==="%"?1:0,F=P==="%"?.1:1,G=(r.has(y)?1:0)+(a.has(T)?1:0),z=l.filter(Q=>Q.unit!=="%"||he(T)==="%").map(Q=>Q.mainStatValue);for(const[Q,q]of Object.entries(A)){const X=parseInt(Q),te=v.filter(d=>Ue.art.data[d].rarities.includes(X)),H=G+q;if(!(H+2<S)){for(const d of z){const c=or(X,T),p=Math.max(0,c.findIndex(m=>m+F>=d)),w=c[p],u=H+(w.toFixed(j)===d.toFixed(j)?1:0);for(const m of te){const O=u+(t.has(m)?1:0);O>=S&&(O>S&&(C=[]),S=O,C.push({setKey:m,rarity:X,level:p,slotKey:y,mainStatKey:T,substats:[],location:o??"",lock:h}))}}if(H>=S)for(const c of te){const p=H+(t.has(c)?1:0);p>S&&(C=[]),S=p,C.push({setKey:c,rarity:X,level:0,slotKey:y,mainStatKey:T,substats:[],location:o??"",lock:h})}}}}const E={setKey:new Set,rarity:new Set,level:new Set,slotKey:new Set,mainStatKey:new Set,mainStatVal:new Set},L=C[0],i=ar(L.mainStatKey,L.rarity,L.level);L.substats=s.filter((y,T)=>y.key!==L.mainStatKey&&s.slice(0,T).every(P=>P.key!==y.key));for(let y=L.substats.length;y<4;y++)L.substats.push({key:"",value:0});for(const y of C)E.setKey.add(y.setKey),E.rarity.add(y.rarity),E.level.add(y.level),E.slotKey.add(y.slotKey),E.mainStatKey.add(y.mainStatKey);function R(y,T,P){return x(ie,{children:["Unknown ",T," : Set to"," ",n(Le,{color:"error",children:P(y)})]})}function U(y,T,P,j){return x(ie,{children:["Ambiguous ",P," ",n(Le,{color:"error",children:j(y)})," : May also be"," ",T.filter(F=>F!==y).map((F,G)=>x(ie,{children:[n("b",{children:G>0?"/":""}),n(Le,{color:"warning",children:j(F)})]}))]})}function b(y,T,P){return x(ie,{children:["Detected ",T," ",n(Le,{color:"success",children:P(y)})]})}function N(y,T,P){return x(ie,{children:["Inferred ",T," ",n(Le,{color:"warning",children:P(y)})]})}function K(y,T,P,j){const F=new Set([...E[y]].filter(z=>T.has(z))),G=L[y];F.size>1?f[y]=U(G,[...T],P,j):F.size===1?f[y]=b(G,P,j):E[y].size>1?f[y]=R(G,P,j):f[y]=N(G,P,j)}K("setKey",t,"Set",y=>n(nn,{setKey:y})),K("rarity",e,"Rarity",y=>x(ie,{children:[y," ",y!==1?"Stars":"Star"]})),K("slotKey",r,"Slot",y=>n(sn,{slotKey:y})),K("mainStatKey",a,"Main Stat",y=>n("span",{children:xe[y]})),f.substats=n(ie,{children:L.substats.filter(y=>y.key!=="").map((y,T)=>n("div",{children:b(y,"Sub Stat",P=>x(ie,{children:[xe[P.key],"+",$e(P.value,he(P.key)),he(P.key)]}))},T))});const D=y=>x(ie,{children:[$e(y,he(L.mainStatKey)),he(L.mainStatKey)]}),V=he(L.mainStatKey)==="%"?1:0;return l.find(y=>y.mainStatValue.toFixed(V)===i.toFixed(V))?a.has(L.mainStatKey)?(f.level=b(L.level,"Level",y=>"+"+y),f.mainStatVal=b(i,"Main Stat value",D)):(f.level=N(L.level,"Level",y=>"+"+y),f.mainStatVal=N(i,"Main Stat value",D)):(f.level=R(L.level,"Level",y=>"+"+y),f.mainStatVal=R(i,"Main Stat value",D)),[L,f]}function Ke(e){const t=Math.min(...e.map(([,s])=>s)),r=e.filter(([,s])=>s===t).map(([s])=>s);return new Set(r)}function Cn(e){const t=[];for(const r of e)for(const s of ir)t.push([s,_e(r.replace(/\W/g,""),s)]);return Ke(t)}function xn(e){const t=[];for(const r of e)for(const s of Je)t.push([s,_e(r.replace(/\W/g,""),wn[s].replace(/\W/g,""))]);return Ke(t)}function kn(e){var r;const t=[];for(const s of e)for(const a of cr){const l=(r=xe[a])==null?void 0:r.toLowerCase();l.length<=3?s.toLowerCase().includes(l??"")&&t.push([a,0]):t.push([a,_e(s.replace(/\W/g,""),(xe[a]??"").replace(/\W/g,""))])}return Ke(t)}function Ln(e){const t=[];for(const r of e){let s=/(\d+[,|\\.]+\d)%/,a=s.exec(r);a&&t.push({mainStatValue:parseFloat(a[1].replace(/,/g,".").replace(/\.{2,}/g,".")),unit:"%"}),s=/(\d+[,|\\.]\d{3}|\d{2,3})/,a=s.exec(r),a&&t.push({mainStatValue:parseInt(a[1].replace(/[,|\\.]+/g,""))})}return t}function An(e){const t=[];for(let r of e)r=r.replace(/^[\W]+/,"").replace(/\n/,""),Ze.forEach(s=>{const a=xe[s],o=(he(s)==="%"?new RegExp(a+"\\s*\\+\\s*(\\d+[\\.|,]+\\d)%","im"):new RegExp(a+"\\s*\\+\\s*(\\d+,\\d+|\\d+)($|\\s)","im")).exec(r);o&&t.push({key:s,value:parseFloat(o[1].replace(/,/g,".").replace(/\.{2,}/g,"."))})});return t.slice(0,4)}function Rn(e){const t=[];for(let s of e){if(!s)continue;const a=s.indexOf(":");if(a!==-1&&(s=s.slice(a+1)),!!s)for(const l of lr)t.push([l,_e(s.replace(/\W/g,""),l)])}t.push(["Traveler",8]);const[r]=Ke(t);return r}async function Tn(e,t,r=!1){const{f:s,fName:a}=e,l=await cn(s),o=await ln(l),h=r?{}:void 0,f=En(o,h),v=Y(f),S=On(f),[C,A]=S?ye(S,.7,1):[0,0],E=Ce(f,de(Me),le(Me),!1),[L,i]=ye(E,.8,2);let R=i;const U=Ce(o,de(vt),le(vt),!1),b=U.some(k=>k>f.width*.5),[N,K]=ye(U);if(b)R=K;else{const k=Fe(f,de(Te),le(Te),!1),[_,J]=ye(k,.2),Z=J-_;J>R&&(R=ne(J+Z,0,f.height))}const D=fe(v,{y1:C,y2:R}),V=b?fe(v,{y1:N,y2:K}):void 0,y=fe(v,{x1:0,x2:v.width*.6,y1:A,y2:L});if(h){const k=Y(f);S&&ge(k,S,{r:0,g:150,b:150,a:100},!1),ge(k,E,{r:150,g:0,b:0,a:100},!1),ge(k,U,{r:0,g:0,b:100,a:100},!1),me(k,C,{r:0,g:255,b:0,a:200},!1),me(k,b?K:R,{r:0,g:0,b:255,a:200},!1),me(k,L,{r:255,g:0,b:200,a:200},!1),h.artifactCardAnalysis=k.toDataURL()}h&&(h.headerCropped=Y(y).toDataURL());const T=fe(v,{y1:L,y2:R}),P=Fe(T,de(Te),le(Te),!1),[j,F]=ye(P,.2);if(h){const k=Y(T);ge(k,P,{r:100,g:0,b:0,a:100},!1),me(k,j,{r:0,g:255,b:0,a:200},!1),me(k,F,{r:0,g:0,b:255,a:200},!1),h.whiteCardAnalysis=k.toDataURL()}const G=F-j,z=fe(Y(T),{y1:j-G,y2:F+G}),Q=fe(Y(T),{y2:j}),q=Fe(T,de(wt),le(wt)),X=q.filter(k=>k>5).length>5;if(h){const k=Y(Q);ge(k,q,{r:0,g:100,b:0,a:100}),h.substatsCardCropped=k.toDataURL()}const te=je(y,{r:140,g:140,b:140},{r:255,g:255,b:255},"bw"),H=je(z,{r:30,g:100,b:30},{r:200,g:255,b:200},"bw"),d=V&&je(V,de(bn),le(yn),"bw");h&&(h.bwHeader=Y(te).toDataURL(),h.greenTextCropped=Y(z).toDataURL(),h.bwGreenText=Y(H).toDataURL(),d&&(h.bwEquipped=Y(d).toDataURL()));const[c,p,w,u]=await Promise.all([t(te),t(Q),t(H),d&&t(d)]),m=Pn(y,h),[O,$]=Sn(new Set([m]),Cn(w),xn(c),An(p),kn(c),Ln(c),u?Rn(u):"",X);return{fileName:a,imageURL:Y(D).toDataURL(),artifact:O,texts:$,debugImgs:h}}function En(e,t){const r=Ce(e,de(Me),le(Me)),[s,a]=ye(r),l=fe(Y(e),{x1:s,x2:a});if(t){const o=Y(e);ge(o,r,{r:255,g:0,b:0,a:100}),me(o,s,{r:0,g:255,b:0,a:150}),me(o,a,{r:0,g:0,b:255,a:150}),t.fullAnalysis=o.toDataURL()}return l}function Pn(e,t){const r=Ce(e,de(Ee),le(Ee),!1),[s,a]=ye(r,.3),l=fe(Y(e),{y1:s,y2:a}),o=Ce(l,de(Ee),le(Ee));if(t){const S=Y(l);ge(S,o,{r:100,g:0,b:0,a:100}),t.rarity=S.toDataURL()}const h=Math.max(...o)*.5;let f=0,v=!1;for(let S=0;S<o.length;S++)o[S]>h?v||(f++,v=!0):v&&(v=!1);return ne(f,1,5)}function On(e){const r=e.width*.7;function s(l,o){const h=Ce(e,de(l,20),le(o,20),!1,[0,.3]);return h.find(f=>f>r)?h:null}return[[un,hn],[fn,pn],[mn,gn]].reduce((l,o)=>l||s(o[0],o[1]),null)}const $n=3,Dn=16;class Mn{constructor(t,r=!1){this.processed=[],this.outstanding=[],this.scanning=[],this.callback=()=>{},this.textsFromImage=t,this.debug=r}addFiles(t){this.outstanding.push(...t),this.processQueue()}processQueue(){const t=Math.min(Dn-this.processed.length-this.scanning.length,$n-this.scanning.length,this.outstanding.length);t&&this.outstanding.splice(0,t).map(r=>{const s=Tn(r,this.textsFromImage,this.debug);this.scanning.push(s),s.then(a=>{const l=this.scanning.indexOf(s);l!==-1&&(this.scanning.splice(l,1),this.processed.push(a),this.processQueue())})}),this.callCB()}callCB(){this.callback({processedNum:this.processed.length,outstandingNum:this.outstanding.length,scanningNum:this.scanning.length})}shiftProcessed(){const t=this.processed.shift();return t&&this.processQueue(),t}clearQueue(){this.processed=[],this.outstanding=[],this.scanning=[],this.callCB()}}function In({slotKey:e="",onChange:t,hasUnselect:r=!1,...s}){const{t:a}=Xe(["artifact","ui"]);return x(rt,{title:a(e?`artifact:slotName:${e}`:"artifact:slot"),color:e?"success":"primary",startIcon:e?n(ht,{slotKey:e}):void 0,...s,children:[r&&x(Re,{selected:e==="",disabled:e==="",onClick:()=>t(""),children:[n(We,{children:n(It,{})}),n(ze,{children:a`ui:unselect`})]}),r&&n(He,{}),Je.map(l=>x(Re,{selected:e===l,disabled:e===l,onClick:()=>t(l),children:[n(We,{children:n(ht,{slotKey:l})}),n(ze,{children:a(`artifact:slotName:${l}`)})]},l))]})}function _n({value:e,onChange:t,disabled:r=!1,float:s=!1,...a}){const[l,o]=M.useState(""),h=M.useCallback(()=>{if(l==="")return t(0);t((s?parseFloat:parseInt)(l))},[t,l,s]);return M.useEffect(()=>o((e==null?void 0:e.toString())??""),[e,o]),n(jr,{value:l,"aria-label":"custom-input",type:"number",onChange:f=>o(f.target.value),onBlur:h,disabled:r,onKeyDown:f=>f.key==="Enter"&&h(),...a})}function St({efficiency:e,max:t=!1,t:r,valid:s}){const a=t?"maxSubEff":"curSubEff";return n($t,{sx:{py:1,px:2},children:x(I,{container:!0,spacing:1,children:[n(I,{item:!0,children:r(`editor.${a}`)}),n(I,{item:!0,flexGrow:1,children:n(Ur,{title:x("span",{children:[n(B,{variant:"h6",children:r(`editor.${a}`)}),n(B,{children:n(et,{t:r,i18nKey:`editor.${a}Desc`})})]})})}),n(I,{item:!0,xs:"auto",children:n(Mt,{valid:s,max:900,value:s?e:"ERR"})})]})})}function Nn({index:e,artifact:t,setSubstat:r}){const{t:s}=Xe("artifact"),{mainStatKey:a="",rarity:l=5}=t??{},{key:o="",value:h=0,rolls:f=[],efficiency:v=0}=(t==null?void 0:t.substats[e])??{},S=f.reduce((b,N)=>b+N,0),C=dr.unit(o),A=f.length;let E="",L=[],i=0;if(t){const b=t.rarity,{numUpgrades:N,high:K}=mr[b];i=N+K-3-A,L=o?ur(o,b):[]}const R=7-L.length;!A&&o&&h&&(E=E||s`editor.substat.error.noCalc`),i<0&&(E=E||s("editor.substat.error.noOverRoll",{value:i+A}));const U=M.useMemo(()=>o?[{value:0},...hr(l,o).map(b=>({value:b}))]:[{value:0}],[o,l]);return x($t,{children:[n(ee,{sx:{display:"flex"},children:x(_t,{size:"small",sx:{width:"100%",display:"flex"},children:[x(rt,{startIcon:o?n(qe,{statKey:o}):void 0,title:o?n(Ye,{statKey:o}):s("editor.substat.substatFormat",{value:e+1}),disabled:!t,color:o?"success":"primary",sx:{whiteSpace:"nowrap"},children:[o&&n(Re,{onClick:()=>r(e,{key:"",value:0}),children:s`editor.substat.noSubstat`}),Ze.filter(b=>a!==b).map(b=>x(Re,{selected:o===b,disabled:o===b,onClick:()=>r(e,{key:b,value:0}),children:[n(We,{children:n(qe,{statKey:b})}),n(ze,{children:n(Ye,{statKey:b})})]},b))]}),n(fr,{sx:{flexBasis:30,flexGrow:1},children:n(pr,{float:C==="%",placeholder:s`editor.substat.selectSub`,value:o?h:void 0,onChange:b=>r(e,{key:o,value:b??0}),disabled:!o,error:!!E,sx:{px:1},inputProps:{sx:{textAlign:"right"}}})}),!!L.length&&n(Gr,{children:s`editor.substat.nextRolls`}),L.map((b,N)=>{var D,V;let K=$e(S+b,C);return K=((V=(D=Ue.art.subRollCorrection[l])==null?void 0:D[o])==null?void 0:V[K])??K,n(re,{color:`roll${ne(R+N,1,6)}`,disabled:h&&!A||i<=0,onClick:()=>r(e,{key:o,value:parseFloat(K)}),children:K},N)})]})}),n(ee,{px:2,children:n(Kn,{value:h,marks:U,setValue:b=>r(e,{key:o,value:b??0}),disabled:!o})}),n(ee,{sx:{px:1,pb:1},children:E?n(dt,{color:"error",children:s`ui:error`}):x(I,{container:!0,children:[n(I,{item:!0,children:n(dt,{color:A===0?"secondary":`roll${ne(A,1,6)}`,children:A?s("editor.substat.RollCount",{count:A}):s`editor.substat.noRoll`})}),n(I,{item:!0,flexGrow:1,children:!!f.length&&[...f].sort().map((b,N)=>n(B,{component:"span",color:`roll${ne(R+L.indexOf(b),1,6)}.main`,sx:{ml:1},children:$e(b,C)},`${N}.${b}`))}),n(I,{item:!0,xs:"auto",flexShrink:1,children:n(B,{children:x(et,{t:s,i18nKey:"editor.substat.eff",color:"text.secondary",children:["Efficiency: ",n(Mt,{valid:!0,max:A*100,value:v||s`editor.substat.noStat`})]})})})]})})]})}function Kn({value:e,setValue:t,marks:r,disabled:s=!1}){var o;const[a,l]=M.useState(e);return M.useEffect(()=>l(e),[e]),n(zr,{value:a,step:null,disabled:s,marks:r,min:0,max:((o=r[r.length-1])==null?void 0:o.value)??0,onChange:(h,f)=>l(f),onChangeCommitted:(h,f)=>t(f),valueLabelDisplay:"auto"})}const jn=""+new URL("scanned-f7f27047.png",import.meta.url).href,Fn=""+new URL("fullscreen-9e994755.png",import.meta.url).href;function Bn({modalShow:e,hide:t}){return n(tt,{open:e,onClose:t,children:x(gr,{children:[n(be,{sx:{py:1},children:x(I,{container:!0,children:[n(I,{item:!0,flexGrow:1,children:n(B,{variant:"subtitle1",children:"How to Upload Screenshots for parsing"})}),n(I,{item:!0,children:n(Ve,{onClick:t})})]})}),n(He,{}),x(be,{children:[x(Dt,{variant:"outlined",severity:"warning",children:["NOTE: Artifact Scanning currently only works for"," ",n("strong",{children:"ENGLISH"})," artifacts."]}),x(I,{container:!0,spacing:1,mt:1,children:[n(I,{item:!0,xs:8,md:6,children:n(ee,{component:"img",alt:"snippet of the screen to take",src:Fn,width:"100%",height:"auto"})}),x(I,{item:!0,xs:12,md:6,children:[n(B,{gutterBottom:!0,children:"Using screenshots can dramatically decrease the amount of time you manually input in stats on the Genshin Optimizer."}),n(B,{variant:"h5",children:"Where to snip the screenshot."}),x(B,{gutterBottom:!0,children:["In game, Open your bag, and navigate to the artifacts tab. Select the artifact you want to scan with Genshin Optimizer."," ",n("b",{children:"Only artifact from this screen can be scanned."})]}),n(B,{variant:"h6",children:"Single artifact"}),x(B,{gutterBottom:!0,children:["To take a screenshot, in Windows, the shortcut is"," ",n("strong",{children:"Alt + Print Screen"}),". Once you selected the region, the image is automatically included in your clipboard."]}),n(B,{variant:"h6",children:"Multiple artifacts"}),x(B,{gutterBottom:!0,children:["To take advantage of batch uploads, you can use a tool like"," ",n("a",{href:"https://picpick.app/",target:"_blank",rel:"noreferrer",children:"PicPick"})," ","to create a macro to easily to screenshot multiple artifacts at once."]}),n(B,{variant:"h5",children:"What to include in the screenshot."}),n(B,{children:"The full genshin window, or at least a region that covers the artifact card."})]}),x(I,{item:!0,xs:12,md:7,children:[n(B,{variant:"h5",children:"Adding Screenshot to Genshin Optimizer"}),n(B,{children:"At this point, you should have the artifact screenshot either saved to your harddrive, or in your clipboard."}),n(B,{gutterBottom:!0,children:'You can click on the box next to "Browse" to browse the files in your harddrive for multiple screenshots.'}),x(B,{children:["For single screenshots from the snippets, just press"," ",n("strong",{children:"Ctrl + V"})," to paste from your clipboard."]}),x(B,{gutterBottom:!0,children:["You should be able to see a Preview of your artifact snippet, and after waiting a few seconds, the artifact set and the substats will be filled in in the ",n("b",{children:"Artifact Editor"}),"."]}),n(B,{variant:"h5",children:"Finishing the Artifact"}),x(B,{children:["Unfortunately, computer vision is not 100%. There will always be cases where something is not scanned properly. You should always double check the scanned artifact values! Once the artifact has been filled, Click on ",n("strong",{children:"Add Artifact"})," to finish editing the artifact."]})]}),n(I,{item:!0,xs:8,md:5,children:n(ee,{component:"img",alt:"main screen after importing stats",src:jn,width:"100%",height:"auto"})})]})]}),n(He,{}),n(be,{sx:{py:1},children:n(Ve,{large:!0,onClick:t})})]})})}var Un={exports:{}};(function(e){var t=function(r){var s=Object.prototype,a=s.hasOwnProperty,l=Object.defineProperty||function(d,c,p){d[c]=p.value},o,h=typeof Symbol=="function"?Symbol:{},f=h.iterator||"@@iterator",v=h.asyncIterator||"@@asyncIterator",S=h.toStringTag||"@@toStringTag";function C(d,c,p){return Object.defineProperty(d,c,{value:p,enumerable:!0,configurable:!0,writable:!0}),d[c]}try{C({},"")}catch{C=function(c,p,w){return c[p]=w}}function A(d,c,p,w){var u=c&&c.prototype instanceof N?c:N,m=Object.create(u.prototype),O=new X(w||[]);return l(m,"_invoke",{value:G(d,p,O)}),m}r.wrap=A;function E(d,c,p){try{return{type:"normal",arg:d.call(c,p)}}catch(w){return{type:"throw",arg:w}}}var L="suspendedStart",i="suspendedYield",R="executing",U="completed",b={};function N(){}function K(){}function D(){}var V={};C(V,f,function(){return this});var y=Object.getPrototypeOf,T=y&&y(y(te([])));T&&T!==s&&a.call(T,f)&&(V=T);var P=D.prototype=N.prototype=Object.create(V);K.prototype=D,l(P,"constructor",{value:D,configurable:!0}),l(D,"constructor",{value:K,configurable:!0}),K.displayName=C(D,S,"GeneratorFunction");function j(d){["next","throw","return"].forEach(function(c){C(d,c,function(p){return this._invoke(c,p)})})}r.isGeneratorFunction=function(d){var c=typeof d=="function"&&d.constructor;return c?c===K||(c.displayName||c.name)==="GeneratorFunction":!1},r.mark=function(d){return Object.setPrototypeOf?Object.setPrototypeOf(d,D):(d.__proto__=D,C(d,S,"GeneratorFunction")),d.prototype=Object.create(P),d},r.awrap=function(d){return{__await:d}};function F(d,c){function p(m,O,$,k){var _=E(d[m],d,O);if(_.type==="throw")k(_.arg);else{var J=_.arg,Z=J.value;return Z&&typeof Z=="object"&&a.call(Z,"__await")?c.resolve(Z.__await).then(function(se){p("next",se,$,k)},function(se){p("throw",se,$,k)}):c.resolve(Z).then(function(se){J.value=se,$(J)},function(se){return p("throw",se,$,k)})}}var w;function u(m,O){function $(){return new c(function(k,_){p(m,O,k,_)})}return w=w?w.then($,$):$()}l(this,"_invoke",{value:u})}j(F.prototype),C(F.prototype,v,function(){return this}),r.AsyncIterator=F,r.async=function(d,c,p,w,u){u===void 0&&(u=Promise);var m=new F(A(d,c,p,w),u);return r.isGeneratorFunction(c)?m:m.next().then(function(O){return O.done?O.value:m.next()})};function G(d,c,p){var w=L;return function(m,O){if(w===R)throw new Error("Generator is already running");if(w===U){if(m==="throw")throw O;return H()}for(p.method=m,p.arg=O;;){var $=p.delegate;if($){var k=z($,p);if(k){if(k===b)continue;return k}}if(p.method==="next")p.sent=p._sent=p.arg;else if(p.method==="throw"){if(w===L)throw w=U,p.arg;p.dispatchException(p.arg)}else p.method==="return"&&p.abrupt("return",p.arg);w=R;var _=E(d,c,p);if(_.type==="normal"){if(w=p.done?U:i,_.arg===b)continue;return{value:_.arg,done:p.done}}else _.type==="throw"&&(w=U,p.method="throw",p.arg=_.arg)}}}function z(d,c){var p=c.method,w=d.iterator[p];if(w===o)return c.delegate=null,p==="throw"&&d.iterator.return&&(c.method="return",c.arg=o,z(d,c),c.method==="throw")||p!=="return"&&(c.method="throw",c.arg=new TypeError("The iterator does not provide a '"+p+"' method")),b;var u=E(w,d.iterator,c.arg);if(u.type==="throw")return c.method="throw",c.arg=u.arg,c.delegate=null,b;var m=u.arg;if(!m)return c.method="throw",c.arg=new TypeError("iterator result is not an object"),c.delegate=null,b;if(m.done)c[d.resultName]=m.value,c.next=d.nextLoc,c.method!=="return"&&(c.method="next",c.arg=o);else return m;return c.delegate=null,b}j(P),C(P,S,"Generator"),C(P,f,function(){return this}),C(P,"toString",function(){return"[object Generator]"});function Q(d){var c={tryLoc:d[0]};1 in d&&(c.catchLoc=d[1]),2 in d&&(c.finallyLoc=d[2],c.afterLoc=d[3]),this.tryEntries.push(c)}function q(d){var c=d.completion||{};c.type="normal",delete c.arg,d.completion=c}function X(d){this.tryEntries=[{tryLoc:"root"}],d.forEach(Q,this),this.reset(!0)}r.keys=function(d){var c=Object(d),p=[];for(var w in c)p.push(w);return p.reverse(),function u(){for(;p.length;){var m=p.pop();if(m in c)return u.value=m,u.done=!1,u}return u.done=!0,u}};function te(d){if(d){var c=d[f];if(c)return c.call(d);if(typeof d.next=="function")return d;if(!isNaN(d.length)){var p=-1,w=function u(){for(;++p<d.length;)if(a.call(d,p))return u.value=d[p],u.done=!1,u;return u.value=o,u.done=!0,u};return w.next=w}}return{next:H}}r.values=te;function H(){return{value:o,done:!0}}return X.prototype={constructor:X,reset:function(d){if(this.prev=0,this.next=0,this.sent=this._sent=o,this.done=!1,this.delegate=null,this.method="next",this.arg=o,this.tryEntries.forEach(q),!d)for(var c in this)c.charAt(0)==="t"&&a.call(this,c)&&!isNaN(+c.slice(1))&&(this[c]=o)},stop:function(){this.done=!0;var d=this.tryEntries[0],c=d.completion;if(c.type==="throw")throw c.arg;return this.rval},dispatchException:function(d){if(this.done)throw d;var c=this;function p(k,_){return m.type="throw",m.arg=d,c.next=k,_&&(c.method="next",c.arg=o),!!_}for(var w=this.tryEntries.length-1;w>=0;--w){var u=this.tryEntries[w],m=u.completion;if(u.tryLoc==="root")return p("end");if(u.tryLoc<=this.prev){var O=a.call(u,"catchLoc"),$=a.call(u,"finallyLoc");if(O&&$){if(this.prev<u.catchLoc)return p(u.catchLoc,!0);if(this.prev<u.finallyLoc)return p(u.finallyLoc)}else if(O){if(this.prev<u.catchLoc)return p(u.catchLoc,!0)}else if($){if(this.prev<u.finallyLoc)return p(u.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(d,c){for(var p=this.tryEntries.length-1;p>=0;--p){var w=this.tryEntries[p];if(w.tryLoc<=this.prev&&a.call(w,"finallyLoc")&&this.prev<w.finallyLoc){var u=w;break}}u&&(d==="break"||d==="continue")&&u.tryLoc<=c&&c<=u.finallyLoc&&(u=null);var m=u?u.completion:{};return m.type=d,m.arg=c,u?(this.method="next",this.next=u.finallyLoc,b):this.complete(m)},complete:function(d,c){if(d.type==="throw")throw d.arg;return d.type==="break"||d.type==="continue"?this.next=d.arg:d.type==="return"?(this.rval=this.arg=d.arg,this.method="return",this.next="end"):d.type==="normal"&&c&&(this.next=c),b},finish:function(d){for(var c=this.tryEntries.length-1;c>=0;--c){var p=this.tryEntries[c];if(p.finallyLoc===d)return this.complete(p.completion,p.afterLoc),q(p),b}},catch:function(d){for(var c=this.tryEntries.length-1;c>=0;--c){var p=this.tryEntries[c];if(p.tryLoc===d){var w=p.completion;if(w.type==="throw"){var u=w.arg;q(p)}return u}}throw new Error("illegal catch attempt")},delegateYield:function(d,c,p){return this.delegate={iterator:te(d),resultName:c,nextLoc:p},this.method==="next"&&(this.arg=o),b}},r}(e.exports);try{regeneratorRuntime=t}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=t:Function("r","regeneratorRuntime = r")(t)}})(Un);var nt=(e,t)=>`${e}-${t}-${Math.random().toString(16).slice(3,8)}`;const Gn=nt;let Ct=0;var jt=({id:e,action:t,payload:r={}})=>{let s=e;return typeof s>"u"&&(s=Gn("Job",Ct),Ct+=1),{id:s,action:t,payload:r}},ke={};let st=!1;ke.logging=st;ke.setLogging=e=>{st=e};ke.log=(...e)=>st?console.log.apply(globalThis,e):null;const zn=jt,{log:Pe}=ke,Wn=nt;let xt=0;var Hn=()=>{const e=Wn("Scheduler",xt),t={},r={};let s=[];xt+=1;const a=()=>s.length,l=()=>Object.keys(t).length,o=()=>{if(s.length!==0){const C=Object.keys(t);for(let A=0;A<C.length;A+=1)if(typeof r[C[A]]>"u"){s[0](t[C[A]]);break}}},h=(C,A)=>new Promise((E,L)=>{const i=zn({action:C,payload:A});s.push(async R=>{s.shift(),r[R.id]=i;try{E(await R[C].apply(globalThis,[...A,i.id]))}catch(U){L(U)}finally{delete r[R.id],o()}}),Pe(`[${e}]: Add ${i.id} to JobQueue`),Pe(`[${e}]: JobQueue length=${s.length}`),o()});return{addWorker:C=>(t[C.id]=C,Pe(`[${e}]: Add ${C.id}`),Pe(`[${e}]: Number of workers=${l()}`),o(),C.id),addJob:async(C,...A)=>{if(l()===0)throw Error(`[${e}]: You need to have at least one worker before adding jobs`);return h(C,A)},terminate:async()=>{Object.keys(t).forEach(async C=>{await t[C].terminate()}),s=[]},getQueueLen:a,getNumWorkers:l}};function qn(){return!!(typeof window<"u"&&typeof window.process=="object"&&window.process.type==="renderer"||typeof process<"u"&&typeof process.versions=="object"&&process.versions.electron||typeof navigator=="object"&&typeof navigator.userAgent=="string"&&navigator.userAgent.indexOf("Electron")>=0)}var Yn=qn;const Vn=Yn;var Qn=e=>{const t={};return typeof WorkerGlobalScope<"u"?t.type="webworker":Vn()?t.type="electron":typeof document=="object"?t.type="browser":typeof process=="object"&&typeof yr=="function"&&(t.type="node"),typeof e>"u"?t:t[e]};const Jn=Qn("type")==="browser",Zn=Jn?e=>new URL(e,window.location.href).href:e=>e;var Xn=e=>{const t={...e};return["corePath","workerPath","langPath"].forEach(r=>{e[r]&&(t[r]=Zn(t[r]))}),t},es=e=>{const t=[],r=[],s=[],a=[],l=[];return e.blocks&&e.blocks.forEach(o=>{o.paragraphs.forEach(h=>{h.lines.forEach(f=>{f.words.forEach(v=>{v.symbols.forEach(S=>{l.push({...S,page:e,block:o,paragraph:h,line:f,word:v})}),a.push({...v,page:e,block:o,paragraph:h,line:f})}),s.push({...f,page:e,block:o,paragraph:h})}),r.push({...h,page:e,block:o})}),t.push({...o,page:e})}),{...e,blocks:t,paragraphs:r,lines:s,words:a,symbols:l}},Ft={TESSERACT_ONLY:0,LSTM_ONLY:1,TESSERACT_LSTM_COMBINED:2,DEFAULT:3};const ts="tesseract.js",rs="5.0.2",ns="Pure Javascript Multilingual OCR",ss="src/index.js",os="src/index.d.ts",as="dist/tesseract.min.js",is="dist/tesseract.min.js",cs={start:"node scripts/server.js",build:"rimraf dist && webpack --config scripts/webpack.config.prod.js && rollup -c scripts/rollup.esm.mjs","profile:tesseract":"webpack-bundle-analyzer dist/tesseract-stats.json","profile:worker":"webpack-bundle-analyzer dist/worker-stats.json",prepublishOnly:"npm run build",wait:"rimraf dist && wait-on http://localhost:3000/dist/tesseract.min.js",test:"npm-run-all -p -r start test:all","test:all":"npm-run-all wait test:browser:* test:node:all","test:node":"nyc mocha --exit --bail --require ./scripts/test-helper.js","test:node:all":"npm run test:node -- ./tests/*.test.js","test:browser-tpl":"mocha-headless-chrome -a incognito -a no-sandbox -a disable-setuid-sandbox -a disable-logging -t 300000","test:browser:detect":"npm run test:browser-tpl -- -f ./tests/detect.test.html","test:browser:recognize":"npm run test:browser-tpl -- -f ./tests/recognize.test.html","test:browser:scheduler":"npm run test:browser-tpl -- -f ./tests/scheduler.test.html","test:browser:FS":"npm run test:browser-tpl -- -f ./tests/FS.test.html",lint:"eslint src","lint:fix":"eslint --fix src",postinstall:"opencollective-postinstall || true"},ls={"./src/worker/node/index.js":"./src/worker/browser/index.js"},ds="",us=["jeromewu"],hs="Apache-2.0",fs={"@babel/core":"^7.21.4","@babel/eslint-parser":"^7.21.3","@babel/preset-env":"^7.21.4","@rollup/plugin-commonjs":"^24.1.0",acorn:"^8.8.2","babel-loader":"^9.1.2",buffer:"^6.0.3",cors:"^2.8.5",eslint:"^7.32.0","eslint-config-airbnb-base":"^14.2.1","eslint-plugin-import":"^2.27.5","expect.js":"^0.3.1",express:"^4.18.2",mocha:"^10.2.0","mocha-headless-chrome":"^4.0.0","npm-run-all":"^4.1.5",nyc:"^15.1.0",rimraf:"^5.0.0",rollup:"^3.20.7","wait-on":"^7.0.1",webpack:"^5.79.0","webpack-bundle-analyzer":"^4.8.0","webpack-cli":"^5.0.1","webpack-dev-middleware":"^6.0.2","rollup-plugin-sourcemaps":"^0.6.3"},ps={"bmp-js":"^0.1.0","idb-keyval":"^6.2.0","is-electron":"^2.2.2","is-url":"^1.2.4","node-fetch":"^2.6.9","opencollective-postinstall":"^2.0.3","regenerator-runtime":"^0.13.3","tesseract.js-core":"^5.0.0","wasm-feature-detect":"^1.2.11",zlibjs:"^0.3.1"},ms={"@rollup/pluginutils":"^5.0.2"},gs={type:"git",url:"https://github.com/naptha/tesseract.js.git"},ys={url:"https://github.com/naptha/tesseract.js/issues"},bs="https://github.com/naptha/tesseract.js",vs={type:"opencollective",url:"https://opencollective.com/tesseractjs"},ws={name:ts,version:rs,description:ns,main:ss,types:os,unpkg:as,jsdelivr:is,scripts:cs,browser:ls,author:ds,contributors:us,license:hs,devDependencies:fs,dependencies:ps,overrides:ms,repository:gs,bugs:ys,homepage:bs,collective:vs};var Ss={workerBlobURL:!0,logger:()=>{}};const{version:Cs}=ws,xs=Ss;var ks={...xs,workerPath:`https://cdn.jsdelivr.net/npm/tesseract.js@v${Cs}/dist/worker.min.js`},Ls=({workerPath:e,workerBlobURL:t})=>{let r;if(Blob&&URL&&t){const s=new Blob([`importScripts("${e}");`],{type:"application/javascript"});r=new Worker(URL.createObjectURL(s))}else r=new Worker(e);return r},As=e=>{e.terminate()},Rs=(e,t)=>{e.onmessage=({data:r})=>{t(r)}},Ts=async(e,t)=>{e.postMessage(t)};const Be=e=>new Promise((t,r)=>{const s=new FileReader;s.onload=()=>{t(s.result)},s.onerror=({target:{error:{code:a}}})=>{r(Error(`File could not be read! Code=${a}`))},s.readAsArrayBuffer(e)}),Qe=async e=>{let t=e;if(typeof e>"u")return"undefined";if(typeof e=="string")/data:image\/([a-zA-Z]*);base64,([^"]*)/.test(e)?t=atob(e.split(",")[1]).split("").map(r=>r.charCodeAt(0)):t=await(await fetch(e)).arrayBuffer();else if(typeof HTMLElement<"u"&&e instanceof HTMLElement)e.tagName==="IMG"&&(t=await Qe(e.src)),e.tagName==="VIDEO"&&(t=await Qe(e.poster)),e.tagName==="CANVAS"&&await new Promise(r=>{e.toBlob(async s=>{t=await Be(s),r()})});else if(typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas){const r=await e.convertToBlob();t=await Be(r)}else(e instanceof File||e instanceof Blob)&&(t=await Be(e));return new Uint8Array(t)};var Es=Qe;const Ps=ks,Os=Ls,$s=As,Ds=Rs,Ms=Ts,Is=Es;var _s={defaultOptions:Ps,spawnWorker:Os,terminateWorker:$s,onMessage:Ds,send:Ms,loadImage:Is};const Ns=Xn,Ks=es,ae=jt,{log:kt}=ke,js=nt,pe=Ft,{defaultOptions:Fs,spawnWorker:Bs,terminateWorker:Us,onMessage:Gs,loadImage:Lt,send:zs}=_s;let At=0;var Bt=async(e="eng",t=pe.LSTM_ONLY,r={},s={})=>{const a=js("Worker",At),{logger:l,errorHandler:o,...h}=Ns({...Fs,...r}),f={},v={},S=typeof e=="string"?e.split("+"):e;let C=t,A=s;const E=[pe.DEFAULT,pe.LSTM_ONLY].includes(t)&&!h.legacyCore;let L,i;const R=new Promise((u,m)=>{i=u,L=m}),U=u=>{L(u.message)};let b=Bs(h);b.onerror=U,At+=1;const N=(u,m)=>{f[u]=m},K=(u,m)=>{v[u]=m},D=({id:u,action:m,payload:O})=>new Promise(($,k)=>{kt(`[${a}]: Start ${u}, action=${m}`),N(m,$),K(m,k),zs(b,{workerId:a,jobId:u,action:m,payload:O})}),V=()=>console.warn("`load` is depreciated and should be removed from code (workers now come pre-loaded)"),y=u=>D(ae({id:u,action:"load",payload:{options:{lstmOnly:E,corePath:h.corePath,logging:h.logging}}})),T=(u,m,O)=>D(ae({id:O,action:"FS",payload:{method:"writeFile",args:[u,m]}})),P=(u,m)=>D(ae({id:m,action:"FS",payload:{method:"readFile",args:[u,{encoding:"utf8"}]}})),j=(u,m)=>D(ae({id:m,action:"FS",payload:{method:"unlink",args:[u]}})),F=(u,m,O)=>D(ae({id:O,action:"FS",payload:{method:u,args:m}})),G=()=>console.warn("`loadLanguage` is depreciated and should be removed from code (workers now come with language pre-loaded)"),z=(u,m)=>D(ae({id:m,action:"loadLanguage",payload:{langs:u,options:{langPath:h.langPath,dataPath:h.dataPath,cachePath:h.cachePath,cacheMethod:h.cacheMethod,gzip:h.gzip,lstmOnly:[pe.LSTM_ONLY,pe.TESSERACT_LSTM_COMBINED].includes(C)&&!h.legacyLang}}})),Q=()=>console.warn("`initialize` is depreciated and should be removed from code (workers now come pre-initialized)"),q=(u,m,O,$)=>D(ae({id:$,action:"initialize",payload:{langs:u,oem:m,config:O}})),X=(u="eng",m,O,$)=>{if(E&&[pe.TESSERACT_ONLY,pe.TESSERACT_LSTM_COMBINED].includes(m))throw Error("Legacy model requested but code missing.");const k=m||C;C=k;const _=O||A;A=_;const Z=(typeof u=="string"?u.split("+"):u).filter(se=>!S.includes(se));return S.push(...Z),Z.length>0?z(Z,$).then(()=>q(u,k,_,$)):q(u,k,_,$)},te=(u={},m)=>D(ae({id:m,action:"setParameters",payload:{params:u}})),H=async(u,m={},O={blocks:!0,text:!0,hocr:!0,tsv:!0},$)=>D(ae({id:$,action:"recognize",payload:{image:await Lt(u),options:m,output:O}})),d=(u="Tesseract OCR Result",m=!1,O)=>(console.log("`getPDF` function is depreciated. `recognize` option `savePDF` should be used instead."),D(ae({id:O,action:"getPDF",payload:{title:u,textonly:m}}))),c=async(u,m)=>{if(E)throw Error("`worker.detect` requires Legacy model, which was not loaded.");return D(ae({id:m,action:"detect",payload:{image:await Lt(u)}}))},p=async()=>(b!==null&&(Us(b),b=null),Promise.resolve());Gs(b,({workerId:u,jobId:m,status:O,action:$,data:k})=>{if(O==="resolve"){kt(`[${u}]: Complete ${m}`);let _=k;$==="recognize"?_=Ks(k):$==="getPDF"&&(_=Array.from({...k,length:Object.keys(k).length})),f[$]({jobId:m,data:_})}else if(O==="reject")if(v[$](k),$==="load"&&L(k),o)o(k);else throw Error(k);else O==="progress"&&l({...k,userJobId:m})});const w={id:a,worker:b,setResolve:N,setReject:K,load:V,writeText:T,readText:P,removeFile:j,FS:F,loadLanguage:G,initialize:Q,reinitialize:X,setParameters:te,recognize:H,getPDF:d,detect:c,terminate:p};return y().then(()=>z(e)).then(()=>q(e,t,s)).then(()=>i(w)).catch(()=>{}),R};const Ut=Bt,Ws=async(e,t,r)=>{const s=await Ut(t,1,r);return s.recognize(e).finally(async()=>{await s.terminate()})},Hs=async(e,t)=>{const r=await Ut("osd",0,t);return r.detect(e).finally(async()=>{await r.terminate()})};var qs={recognize:Ws,detect:Hs},Ys={AFR:"afr",AMH:"amh",ARA:"ara",ASM:"asm",AZE:"aze",AZE_CYRL:"aze_cyrl",BEL:"bel",BEN:"ben",BOD:"bod",BOS:"bos",BUL:"bul",CAT:"cat",CEB:"ceb",CES:"ces",CHI_SIM:"chi_sim",CHI_TRA:"chi_tra",CHR:"chr",CYM:"cym",DAN:"dan",DEU:"deu",DZO:"dzo",ELL:"ell",ENG:"eng",ENM:"enm",EPO:"epo",EST:"est",EUS:"eus",FAS:"fas",FIN:"fin",FRA:"fra",FRK:"frk",FRM:"frm",GLE:"gle",GLG:"glg",GRC:"grc",GUJ:"guj",HAT:"hat",HEB:"heb",HIN:"hin",HRV:"hrv",HUN:"hun",IKU:"iku",IND:"ind",ISL:"isl",ITA:"ita",ITA_OLD:"ita_old",JAV:"jav",JPN:"jpn",KAN:"kan",KAT:"kat",KAT_OLD:"kat_old",KAZ:"kaz",KHM:"khm",KIR:"kir",KOR:"kor",KUR:"kur",LAO:"lao",LAT:"lat",LAV:"lav",LIT:"lit",MAL:"mal",MAR:"mar",MKD:"mkd",MLT:"mlt",MSA:"msa",MYA:"mya",NEP:"nep",NLD:"nld",NOR:"nor",ORI:"ori",PAN:"pan",POL:"pol",POR:"por",PUS:"pus",RON:"ron",RUS:"rus",SAN:"san",SIN:"sin",SLK:"slk",SLV:"slv",SPA:"spa",SPA_OLD:"spa_old",SQI:"sqi",SRP:"srp",SRP_LATN:"srp_latn",SWA:"swa",SWE:"swe",SYR:"syr",TAM:"tam",TEL:"tel",TGK:"tgk",TGL:"tgl",THA:"tha",TIR:"tir",TUR:"tur",UIG:"uig",UKR:"ukr",URD:"urd",UZB:"uzb",UZB_CYRL:"uzb_cyrl",VIE:"vie",YID:"yid"},Vs={OSD_ONLY:"0",AUTO_OSD:"1",AUTO_ONLY:"2",AUTO:"3",SINGLE_COLUMN:"4",SINGLE_BLOCK_VERT_TEXT:"5",SINGLE_BLOCK:"6",SINGLE_LINE:"7",SINGLE_WORD:"8",CIRCLE_WORD:"9",SINGLE_CHAR:"10",SPARSE_TEXT:"11",SPARSE_TEXT_OSD:"12",RAW_LINE:"13"};const Qs=Hn,Js=Bt,Zs=qs,Xs=Ys,eo=Ft,to=Vs,{setLogging:ro}=ke;var Rt={languages:Xs,OEM:eo,PSM:to,createScheduler:Qs,createWorker:Js,setLogging:ro,...Zs};const no=2,so=new Hr(async e=>{const t=Rt.createScheduler(),r=Array(no).fill(0).map(async s=>{const a=await Rt.createWorker(e,void 0,{errorHandler:console.error,langPath:"./assets"});t.addWorker(a)});return await Promise.any(r),t},(e,t)=>{t.then(r=>r.terminate())});async function oo(e,t=void 0){const r=Y(e);return(await so.borrow("genshin_fast_09_04_21",async a=>await(await a).addJob("recognize",r,t))).data.lines.map(a=>a.text)}const ao=new Set(Ze);function io(e,t){const s=(()=>{switch(t.type){case"reset":return;case"substat":{const{index:a,substat:l}=t,o=l.key?e.substats.findIndex(h=>h.key===l.key):-1;return o===-1||o===a?e.substats[a]=l:[e.substats[a],e.substats[o]]=[e.substats[o],e.substats[a]],{...e}}case"overwrite":return t.artifact;case"update":return{...e,...t.artifact}}})();return s&&Tr(s,!0)}const co=Ie("input")({display:"none"});function To({artifactIdToEdit:e="",cancelEdit:t,allowUpload:r=!1,allowEmpty:s=!1,disableSet:a=!1,disableSlot:l=!1,fixedSlotKey:o=""}){var it;const f=M.useRef(new Mn(oo,br)).current,{t:v}=Xe("artifact"),S=vr(),[C,A]=M.useState(!1),[E,L]=wr();M.useEffect(()=>S.arts.followAny(L),[S,L]);const[i,R]=M.useReducer(io,void 0),[U,b]=M.useState(!1),[{processedNum:N,outstandingNum:K,scanningNum:D},V]=M.useState({processedNum:0,outstandingNum:0,scanningNum:0}),[y,T]=M.useState(void 0),{fileName:P,imageURL:j,debugImgs:F,texts:G}=y??{},z=N+K+D,Q=!["new",""].includes(e)&&!!(i!=null&&i.location)||l,q=M.useCallback(g=>{g&&(A(!0),f.addFiles(Array.from(g).map(W=>({f:W,fName:W.name}))))},[A,f]),X=M.useCallback(()=>{f.clearQueue()},[f]),te=M.useCallback(g=>{g.target&&(q(g.target.files),g.target.value="")},[q]),{old:H,oldType:d}=M.useMemo(()=>{const g=E&&e&&S.arts.get(e);if(g)return{old:g,oldType:"edit"};if(i===void 0)return{old:void 0,oldType:""};const{duplicated:W,upgraded:oe}=E&&S.arts.findDups(i);return{old:W[0]??oe[0],oldType:W.length!==0?"duplicate":"upgrade"}},[i,e,S,E]),{artifact:c,errors:p}=M.useMemo(()=>i?Sr(i,e):{artifact:void 0,errors:[]},[i,e]),w=i?pt(i.setKey):void 0,u=M.useCallback(()=>{t==null||t(),R({type:"reset"}),T(void 0)},[t,R]),m=M.useCallback(g=>{const W=g.setKey?pt(g.setKey):w;function oe(ve,ct,Vt){return ve&&ct.includes(ve)?ve:Vt??ct[0]}g.setKey&&(g.rarity=oe(i==null?void 0:i.rarity,W.rarity,Math.max(...W.rarity)),g.slotKey=(i==null?void 0:i.slotKey)??(l&&o!==""?o:"flower")),g.rarity&&(g.level=(i==null?void 0:i.level)??0),g.level&&(g.level=ne(g.level,0,4*(g.rarity??i.rarity))),g.slotKey&&(g.mainStatKey=oe(i==null?void 0:i.mainStatKey,Ge[g.slotKey])),g.mainStatKey&&(g.substats=[0,1,2,3].map(ve=>i&&i.substats[ve].key!==g.mainStatKey?i.substats[ve]:{key:"",value:0})),R({type:"update",artifact:g})},[i,w,R,l,o]),O=M.useCallback((g,W)=>{R({type:"substat",index:g,substat:W})},[R]),$=!p.length,k=()=>window.confirm(v`editor.clearPrompt`),{rarity:_=5,level:J=0}=i??{},Z=M.useMemo(()=>(i==null?void 0:i.slotKey)??(l&&o!==""?o:"flower"),[l,o,i]),{currentEfficiency:se=0,maxEfficiency:ot=0}=c?Br.getArtifactEfficiency(c,ao):{},at=M.useCallback(g=>{if(!e&&(z||i)&&!window.confirm(v`editor.clearPrompt`)){g==null||g.preventDefault();return}A(!1),f.clearQueue(),u()},[v,e,f,i,z,A,u]),Gt=Cr(),zt=xr(Gt.breakpoints.up("md")),Wt=i?kr.find(g=>i.mainStatKey.includes(g)):void 0,Ht=i?Wt??"success":"primary",qt=M.useCallback(g=>m({setKey:g}),[m]),Yt=M.useCallback(g=>!!(g===""||Q&&Z!=="circlet"&&(g==="PrayersForDestiny"||g==="PrayersForIllumination"||g==="PrayersForWisdom"||g==="PrayersToSpringtime")),[Q,Z]);return M.useEffect(()=>{e==="new"&&(A(!0),R({type:"reset"}));const g=e&&E&&S.arts.get(e);g&&(A(!0),R({type:"overwrite",artifact:Lr(g)}))},[e,S,E]),M.useEffect(()=>{if(!N||y)return;const g=f.shiftProcessed();if(!g)return;const{artifact:W,...oe}=g;T(oe),R({type:"overwrite",artifact:W})},[f,N,y]),M.useEffect(()=>{const g=W=>{var oe;return q((oe=W.clipboardData)==null?void 0:oe.files)};return r&&window.addEventListener("paste",g),()=>{r&&window.removeEventListener("paste",g)}},[q,r]),M.useEffect(()=>(f.callback=V,()=>{f.callback=()=>{}}),[f]),n(tt,{open:C,onClose:at,children:x(ce,{children:[n(Bn,{modalShow:U,hide:()=>b(!1)}),n(Wr,{title:n(et,{t:v,i18nKey:"editor.title",children:"Artifact Editor"}),action:n(Ve,{disabled:!!z,onClick:at})}),x(be,{sx:{display:"flex",flexDirection:"column",gap:1},children:[x(I,{container:!0,spacing:1,columns:{xs:1,md:2},children:[x(I,{item:!0,xs:1,display:"flex",flexDirection:"column",gap:1,children:[x(ee,{sx:{display:"flex",gap:1},children:[n(Ir,{disabled:a,size:"small",artSetKey:(i==null?void 0:i.setKey)??"",setArtSetKey:qt,sx:{flexGrow:1},label:i!=null&&i.setKey?"":v("editor.unknownSetName"),getOptionDisabled:({key:g})=>Yt(g)}),n(_r,{rarity:i?_:void 0,onChange:g=>m({rarity:g}),filter:g=>{var W,oe;return!!((oe=(W=w==null?void 0:w.rarity)==null?void 0:W.includes)!=null&&oe.call(W,g))},disabled:!w})]}),x(ee,{component:"div",display:"flex",children:[n(_n,{id:"filled-basic",label:"Level",variant:"filled",sx:{flexShrink:1,flexGrow:1,mr:1,my:0},margin:"dense",size:"small",value:J,disabled:!w,placeholder:`0~${_*4}`,onChange:g=>m({level:g})}),x(_t,{children:[n(re,{onClick:()=>m({level:J-1}),disabled:!w||J===0,children:"-"}),_?[...Array(_+1).keys()].map(g=>4*g).map(g=>n(re,{onClick:()=>m({level:g}),disabled:!w||J===g,children:g},g)):null,n(re,{onClick:()=>m({level:J+1}),disabled:!w||J===_*4,children:"+"})]})]}),x(ee,{component:"div",display:"flex",children:[n(In,{disabled:Q||!w||((it=i==null?void 0:i.setKey)==null?void 0:it.startsWith("Prayer")),slotKey:Z,onChange:g=>m({slotKey:g})}),n(ce,{bgt:"light",sx:{p:1,ml:1,flexGrow:1},children:n(M.Suspense,{fallback:n(lt,{width:"60%"}),children:n(B,{color:"text.secondary",children:i&&(w!=null&&w.getSlotName(i.slotKey))?x("span",{children:[n(Fr,{size:2,src:Pr(i.setKey,i.slotKey)}),w==null?void 0:w.getSlotName(i.slotKey)]}):v`editor.unknownPieceName`})})})]}),x(ee,{component:"div",display:"flex",gap:1,children:[n(rt,{startIcon:i!=null&&i.mainStatKey?n(qe,{statKey:i.mainStatKey}):void 0,title:n("b",{children:i?n(Ye,{statKey:i.mainStatKey}):v`mainStat`}),disabled:!w,color:Ht,children:Ge[Z].map(g=>n(Re,{selected:(i==null?void 0:i.mainStatKey)===g,disabled:(i==null?void 0:i.mainStatKey)===g,onClick:()=>m({mainStatKey:g}),children:n($r,{statKey:g})},g))}),n(ce,{bgt:"light",sx:{p:1,flexGrow:1},children:n(B,{color:"text.secondary",children:i?Ar(i.mainStatKey,_,J):v`mainStat`})}),n(re,{disabled:!i,onClick:()=>m({lock:!(i!=null&&i.lock)}),color:i!=null&&i.lock?"success":"primary",children:i!=null&&i.lock?n(Dr,{}):n(Mr,{})})]}),n(Kr,{location:(i==null?void 0:i.location)??"",setLocation:g=>m({location:g}),autoCompleteProps:{disabled:!i}}),n(St,{valid:$,efficiency:se,t:v}),se!==ot&&n(St,{max:!0,valid:$,efficiency:ot,t:v}),r&&n(ce,{bgt:"light",children:n(be,{sx:{display:"flex",flexDirection:"column",gap:1},children:x(M.Suspense,{fallback:n(lt,{width:"100%",height:"100"}),children:[x(I,{container:!0,spacing:1,alignItems:"center",children:[n(I,{item:!0,flexGrow:1,children:x("label",{htmlFor:"contained-button-file",children:[n(co,{accept:"image/*",id:"contained-button-file",multiple:!0,type:"file",onChange:te}),n(re,{component:"span",startIcon:n(on,{}),children:"Upload Screenshot (or Ctrl-V)"})]})}),F&&n(I,{item:!0,children:n(lo,{imgs:F})}),n(I,{item:!0,children:n(re,{color:"info",sx:{px:2,minWidth:0},onClick:()=>b(!0),children:n(Or,{})})})]}),j&&n(ee,{display:"flex",justifyContent:"center",children:n(ee,{component:"img",src:j,width:"100%",maxWidth:350,height:"auto",alt:P||"Screenshot to parse for artifact values"})}),!!z&&n(Rr,{variant:"buffer",value:100*N/z,valueBuffer:100*(N+D)/z}),!!z&&n(ce,{sx:{pl:2},children:x(ee,{display:"flex",alignItems:"center",children:[!!D&&n(rn,{size:"1em"}),n(B,{sx:{flexGrow:1,ml:1},children:x("span",{children:["Screenshots in file-queue:",n("b",{children:z})]})}),n(re,{size:"small",color:"error",onClick:X,children:"Clear file-queue"})]})})]})})})]}),x(I,{item:!0,xs:1,display:"flex",flexDirection:"column",gap:1,children:[[0,1,2,3].map(g=>n(Nn,{index:g,artifact:c,setSubstat:O},g)),G&&n(ce,{bgt:"light",children:x(be,{children:[n("div",{children:G.slotKey}),n("div",{children:G.mainStatKey}),n("div",{children:G.mainStatVal}),n("div",{children:G.rarity}),n("div",{children:G.level}),n("div",{children:G.lock}),n("div",{children:G.substats}),n("div",{children:G.setKey}),n("div",{children:G.location})]})})]})]}),H&&x(I,{container:!0,sx:{justifyContent:"space-around"},spacing:1,children:[n(I,{item:!0,xs:12,md:5.5,lg:4,children:x(ce,{bgt:"light",children:[n(B,{sx:{textAlign:"center"},py:1,variant:"h6",color:"text.secondary",children:d!=="edit"?d==="duplicate"?v`editor.dupArt`:v`editor.upArt`:v`editor.beforeEdit`}),n(ut,{artifactObj:H})]})}),zt&&n(I,{item:!0,md:1,display:"flex",alignItems:"center",justifyContent:"center",children:n(ce,{bgt:"light",sx:{display:"flex"},children:n(Nr,{sx:{fontSize:40}})})}),n(I,{item:!0,xs:12,md:5.5,lg:4,children:x(ce,{bgt:"light",children:[n(B,{sx:{textAlign:"center"},py:1,variant:"h6",color:"text.secondary",children:v`editor.preview`}),n(ut,{artifactObj:c})]})})]}),!$&&n(Dt,{variant:"filled",severity:"error",children:p.map((g,W)=>n("div",{children:g},W))}),x(I,{container:!0,spacing:2,children:[n(I,{item:!0,children:d==="edit"?n(re,{startIcon:n(ft,{}),onClick:()=>{i&&S.arts.set(H.id,i),s||(A(!1),t()),u()},disabled:!i||!$,color:"primary",children:v`editor.btnSave`}):n(re,{startIcon:n(ft,{}),onClick:()=>{S.arts.new(i),s||(A(!1),t()),u()},disabled:!i||!$,color:d==="duplicate"?"warning":"primary",children:v`editor.btnAdd`})}),n(I,{item:!0,flexGrow:1,children:s&&n(re,{startIcon:n(It,{}),disabled:!i,onClick:()=>{k()&&u()},color:"error",children:v`editor.btnClear`})}),n(I,{item:!0,children:!1}),H&&d!=="edit"&&n(I,{item:!0,children:n(re,{startIcon:n(an,{}),onClick:()=>{i&&S.arts.set(H.id,i),s?u():A(!1)},disabled:!i||!$,color:"success",children:v`editor.btnUpdate`})})]})]})]})})}function lo({imgs:e}){const[t,r]=M.useState(!1);return x(ie,{children:[n(re,{color:"warning",onClick:()=>r(!0),children:"DEBUG"}),n(tt,{open:t,onClose:()=>r(!1),children:n(ce,{children:n(be,{children:n(Er,{spacing:1,children:Object.entries(e).map(([l,o])=>x(ee,{children:[n(B,{children:l}),n(ee,{component:"img",src:o,maxWidth:"100%"})]},l))})})})})]})}export{To as default};

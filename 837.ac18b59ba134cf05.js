"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[837],{35837:(t,e,n)=>{n.r(e),n.d(e,{default:()=>ht});var a=n(7671),r=n(62197),l=n(56961),o=n(61877),i=n(21548),c=n(87985),s=n(9725),d=n(6620),Z=n(52322);const h=(0,d.Z)((0,Z.jsx)("path",{d:"M9 3 5 6.99h3V14h2V6.99h3L9 3zm7 14.01V10h-2v7.01h-3L15 21l4-3.99h-3z"}),"ImportExport"),u=(0,d.Z)((0,Z.jsx)("path",{d:"M5 20h14v-2H5v2zm0-10h4v6h6v-6h4l-7-7-7 7z"}),"Upload");var p=n(68164);const g=(0,d.Z)((0,Z.jsx)("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"}),"Delete");var m=n(41075),x=n(83249),C=n(66198),b=n(67550),f=n(2784),y=n(67937),v=n(89343),B=n(38502),w=n(98927),X=n(51650),D=n(94657),k=n(41015),I=n(67732);const G=(0,d.Z)((0,Z.jsx)("path",{d:"M14 2H6c-1.1 0-2 .9-2 2v16c0 1.1.89 2 1.99 2H15v-8h5V8l-6-6zm-1 7V3.5L18.5 9H13zm4 12.66V16h5.66v2h-2.24l2.95 2.95-1.41 1.41L19 19.41v2.24h-2z"}),"FileOpen");var K=n(27216),P=n(5658),$=n(65992),S=n(99479),j=n(76068),O=n(52903);let E,M,W,z,L,T,H,R=t=>t;const V=(0,$.ZP)("input")({display:"none"});function F({index:t,onReplace:e}){var n;const{databases:l}=(0,f.useContext)(X.t),o=l[t],{t:d}=(0,i.$G)("settings"),[Z,h]=(0,f.useState)(""),[u,p]=(0,f.useState)(""),[g,C]=(0,f.useState)(""),[v,B]=(0,f.useState)(!1),[w,D]=(0,f.useState)(!1),{importResult:k,importedDatabase:$}=null!=(n=(0,f.useMemo)((()=>{if(!Z)return;let e;try{if(e=JSON.parse(Z),"object"!=typeof e)return void C("uploadCard.error.jsonParse")}catch(n){return void C("uploadCard.error.jsonParse")}if("GOOD"===e.format){const n=new j.N;n.copyFrom(o.storage);const a=new X.M(t+1,n),r=a.importGOOD(e,v,w);return r?{importResult:r,importedDatabase:a}:void C("uploadCard.error.goInvalid")}C("uploadCard.error.unknown")}),[Z,o,v,w,t]))?n:{};return(0,O.BX)(y.Z,{children:[(0,O.tZ)(a.Z,{sx:{py:1},children:(0,O.tZ)(i.cC,{t:d,i18nKey:"settings:uploadCard.title"})}),(0,O.BX)(a.Z,{children:[(0,O.BX)(m.ZP,{container:!0,spacing:2,sx:{mb:1},children:[(0,O.tZ)(m.ZP,{item:!0,children:(0,O.BX)("label",{htmlFor:"icon-button-file",children:[(0,O.tZ)(V,{accept:".json",id:"icon-button-file",type:"file",onChange:async t=>{const e=t.target.files[0];t.target.value=null,e&&p(e.name);const n=new FileReader;n.onload=()=>h(n.result),n.readAsText(e)}}),(0,O.tZ)(x.Z,{component:"span",color:"info",startIcon:(0,O.tZ)(G,{}),children:d(E||(E=R`uploadCard.buttons.open`))})]})}),(0,O.tZ)(m.ZP,{item:!0,flexGrow:1,children:(0,O.tZ)(c.Z,{sx:{px:2,py:1},children:(0,O.tZ)(r.Z,{children:u?(0,O.BX)("span",{children:[(0,O.tZ)(I.G,{icon:s.w49})," ",u]}):(0,O.BX)("span",{children:[(0,O.tZ)(I.G,{icon:s.acZ})," ",(0,O.tZ)(i.cC,{t:d,i18nKey:"settings:uploadCard.hint"})]})})})})]}),(0,O.BX)(b.Z,{sx:{display:"flex",gap:2,flexWrap:"wrap"},children:[(0,O.tZ)(S.Z,{title:(0,O.tZ)(r.Z,{children:d(w?M||(M=R`uploadCard.tooltip.ignoreDup`):W||(W=R`uploadCard.tooltip.detectdup`))}),placement:"top",arrow:!0,children:(0,O.tZ)(b.Z,{sx:{flexGrow:1,flexBasis:"10em"},children:(0,O.tZ)(x.Z,{fullWidth:!0,disabled:!Z,color:w?"primary":"success",onClick:()=>D(!w),startIcon:w?(0,O.tZ)(K.Z,{}):(0,O.tZ)(P.Z,{}),children:d(z||(z=R`uploadCard.buttons.detectDups`))})})}),(0,O.tZ)(S.Z,{title:(0,O.tZ)(r.Z,{children:d(v?L||(L=R`uploadCard.tooltip.keepNotInImport`):T||(T=R`uploadCard.tooltip.delNotInImport`))}),placement:"top",arrow:!0,children:(0,O.tZ)(b.Z,{sx:{flexGrow:1,flexBasis:"10em"},children:(0,O.tZ)(x.Z,{fullWidth:!0,disabled:!Z,color:v?"primary":"success",onClick:()=>B(!v),startIcon:v?(0,O.tZ)(K.Z,{}):(0,O.tZ)(P.Z,{}),children:d(H||(H=R`uploadCard.buttons.delNotInImport`))})})})]}),(0,O.tZ)(r.Z,{gutterBottom:!0,variant:"caption",children:(0,O.tZ)(i.cC,{t:d,i18nKey:"settings:uploadCard.hintPaste"})}),(0,O.tZ)(b.Z,{component:"textarea",sx:{width:"100%",fontFamily:"monospace",minHeight:"10em",mb:2,resize:"vertical"},value:Z,onChange:t=>h(t.target.value)}),k&&$?(0,O.tZ)(N,{importResult:k,importedDatabase:$}):d(g)]}),(0,O.tZ)(J,{index:t,importedDatabase:$,reset:()=>{h(""),p(""),e()}})]})}function N({importResult:{source:t,artifacts:e,characters:n,weapons:o},importedDatabase:s}){const{t:d}=(0,i.$G)("settings");return(0,O.BX)(c.Z,{children:[(0,O.tZ)(a.Z,{sx:{py:1},children:(0,O.BX)(r.Z,{children:[(0,O.tZ)(i.cC,{t:d,i18nKey:"uploadCard.dbSource"}),(0,O.BX)("strong",{children:[" ",t]})]})}),(0,O.tZ)(l.Z,{}),(0,O.tZ)(a.Z,{children:(0,O.BX)(m.ZP,{container:!0,spacing:2,children:[(0,O.tZ)(m.ZP,{item:!0,flexGrow:1,children:(0,O.tZ)(A,{result:e,dbTotal:s.arts.values.length,type:"arts"})}),(0,O.tZ)(m.ZP,{item:!0,flexGrow:1,children:(0,O.tZ)(A,{result:o,dbTotal:s.weapons.values.length,type:"weapons"})}),(0,O.tZ)(m.ZP,{item:!0,flexGrow:1,children:(0,O.tZ)(A,{result:n,dbTotal:s.chars.values.length,type:"chars"})})]})})]})}function A({result:t,dbTotal:e,type:n}){var o;const{t:c}=(0,i.$G)("settings"),s=t.import;return(0,O.BX)(y.Z,{children:[(0,O.tZ)(a.Z,{sx:{py:1},children:(0,O.BX)(r.Z,{children:[(0,O.tZ)(i.cC,{t:c,i18nKey:`count.${n}`})," ",s]})}),(0,O.tZ)(l.Z,{}),(0,O.BX)(a.Z,{children:[(0,O.BX)(r.Z,{children:[(0,O.tZ)(i.cC,{t:c,i18nKey:"count.new"})," ",(0,O.tZ)("strong",{children:t.new.length})," / ",s]}),(0,O.BX)(r.Z,{children:[(0,O.tZ)(i.cC,{t:c,i18nKey:"count.unchanged"})," ",(0,O.tZ)("strong",{children:t.unchanged.length})," / ",s]}),(0,O.BX)(r.Z,{children:[(0,O.tZ)(i.cC,{t:c,i18nKey:"count.upgraded"})," ",(0,O.tZ)("strong",{children:t.upgraded.length})," / ",s]}),!!t.remove.length&&(0,O.BX)(r.Z,{color:"warning.main",children:[(0,O.tZ)(i.cC,{t:c,i18nKey:"count.removed"})," ",(0,O.tZ)("strong",{children:t.remove.length})]}),!!t.notInImport&&(0,O.BX)(r.Z,{children:[(0,O.tZ)(i.cC,{t:c,i18nKey:"count.notInImport"})," ",(0,O.tZ)("strong",{children:t.notInImport})]}),(0,O.BX)(r.Z,{children:[(0,O.tZ)(i.cC,{t:c,i18nKey:"count.dbTotal"})," ",(0,O.tZ)("strong",{children:t.beforeMerge})," -> ",(0,O.tZ)("strong",{children:e})]}),!(null==(o=t.invalid)||!o.length)&&(0,O.BX)("div",{children:[(0,O.BX)(r.Z,{color:"error.main",children:[(0,O.tZ)(i.cC,{t:c,i18nKey:"count.invalid"})," ",(0,O.tZ)("strong",{children:t.invalid.length})," / ",s]}),(0,O.tZ)(b.Z,{component:"textarea",sx:{width:"100%",fontFamily:"monospace",minHeight:"10em",resize:"vertical"},value:JSON.stringify(t.invalid,void 0,2),disabled:!0})]})]})]})}function J({index:t,importedDatabase:e,reset:n}){const{databases:r,setDatabase:o}=(0,f.useContext)(X.t),c=r[t],{t:d}=(0,i.$G)("settings"),Z=(0,f.useCallback)((()=>{e&&(e.swapStorage(c),o(t,e),e.toExtraLocalDB(),n())}),[c,t,e,n,o]);return(0,O.BX)(O.HY,{children:[(0,O.tZ)(l.Z,{}),(0,O.tZ)(a.Z,{sx:{py:1},children:(0,O.tZ)(x.Z,{color:e?"success":"error",disabled:!e,onClick:Z,startIcon:(0,O.tZ)(I.G,{icon:s.Y9i}),children:(0,O.tZ)(i.cC,{t:d,i18nKey:"settings:uploadCard.replaceDatabase"})})})]})}let _,Y,U,q,Q,tt,et,nt=t=>t;function at(){const{t}=(0,i.$G)(["settings"]);return(0,O.BX)(y.Z,{children:[(0,O.tZ)(a.Z,{sx:{py:1},children:(0,O.tZ)(r.Z,{variant:"subtitle1",children:t(_||(_=nt`DatabaseCard.title`))})}),(0,O.tZ)(l.Z,{}),(0,O.tZ)(a.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:(0,O.tZ)(m.ZP,{container:!0,spacing:2,columns:{xs:1,md:2},children:(0,k.w6)(0,3).map((t=>(0,O.tZ)(m.ZP,{item:!0,xs:1,children:(0,O.tZ)(rt,{index:t})},t)))})})]})}function rt({index:t}){const{databases:e,database:n,setDatabase:o}=(0,f.useContext)(X.t),d=e[t],[{name:Z,lastEdit:y},k]=(0,f.useState)(d.dbMeta.get());(0,f.useEffect)((()=>d.dbMeta.follow(((t,e)=>k(e)))),[d]),(0,f.useEffect)((()=>k(d.dbMeta.get())),[d]);const I=n===d,[G,K,P]=(0,D.Z)(),{t:$}=(0,i.$G)(["settings"]),S=d.chars.keys.length,j=d.arts.values.length,E=d.weapons.values.length,M=Boolean(S||j||E),W=(0,f.useCallback)((()=>navigator.clipboard.writeText(JSON.stringify(d.exportGOOD())).then((()=>alert("Copied database to clipboard."))).catch(console.error)),[d]),z=(0,f.useCallback)((()=>{window.confirm(`Are you sure you want to delete "${Z}"?`)&&(d.clear(),d.toExtraLocalDB())}),[d,Z]),L=(0,f.useCallback)((()=>{const t=(new Date).toISOString().split(".")[0].replace("T","_").replaceAll(":","-"),e=JSON.stringify(d.exportGOOD()),n=`${Z.trim().replaceAll(" ","_")}_${t}.json`,a=document.createElement("a");a.download=n,a.href=`data:application/json;charset=utf-8,${encodeURIComponent(e)}`,a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)}),[d,Z]),T=(0,f.useCallback)((()=>{I||(n.toExtraLocalDB(),d.swapStorage(n),o(t,d))}),[t,o,n,I,d]),[H,R]=(0,f.useState)(Z);(0,f.useEffect)((()=>R(Z)),[Z]);const V=(0,f.useCallback)((()=>{d.dbMeta.set({name:H}),d.toExtraLocalDB()}),[H,d]),N=(0,f.useCallback)((t=>"Enter"===t.key&&V()),[V]);return(0,O.BX)(c.Z,{sx:{height:"100%",boxShadow:I?"0px 0px 0px 2px green inset":void 0},children:[(0,O.BX)(a.Z,{sx:{display:"flex",gap:1,justifyContent:"space-between"},children:[(0,O.tZ)(v.el,{value:H,sx:{borderRadius:1,px:1,flexGrow:1},onChange:t=>R(t.target.value),onBlur:V,onKeyDown:N}),!I&&(0,O.tZ)(x.Z,{startIcon:(0,O.tZ)(h,{}),onClick:T,color:"warning",children:$(Y||(Y=nt`DatabaseCard.button.swap`))}),(0,O.tZ)(C.Z,{color:I?"success":"secondary",label:I?$(U||(U=nt`DatabaseCard.currentDB`)):`${$(q||(q=nt`DatabaseCard.title`))} ${d.dbIndex}`})]}),(0,O.tZ)(l.Z,{}),(0,O.tZ)(a.Z,{children:(0,O.BX)(b.Z,{display:"flex",gap:2,children:[(0,O.BX)(b.Z,{flexGrow:1,children:[(0,O.BX)(r.Z,{noWrap:!0,children:[(0,O.tZ)(i.cC,{t:$,i18nKey:"count.chars"})," ",(0,O.tZ)("strong",{children:S})]}),(0,O.BX)(r.Z,{noWrap:!0,children:[(0,O.tZ)(i.cC,{t:$,i18nKey:"count.arts"})," ",(0,O.tZ)("strong",{children:j})]}),(0,O.BX)(r.Z,{noWrap:!0,children:[(0,O.tZ)(i.cC,{t:$,i18nKey:"count.weapons"})," ",(0,O.tZ)("strong",{children:E})]}),!!y&&(0,O.tZ)(r.Z,{noWrap:!0,children:(0,O.tZ)("strong",{children:new Date(y).toLocaleString()})})]}),(0,O.tZ)(b.Z,{children:(0,O.BX)(m.ZP,{container:!0,spacing:1,columns:{xs:2},children:[(0,O.tZ)(m.ZP,{item:!0,xs:1,children:(0,O.tZ)(x.Z,{fullWidth:!0,disabled:!M,color:"info",onClick:W,startIcon:(0,O.tZ)(B.Z,{icon:s.Yjj}),children:(0,O.tZ)(i.cC,{t:$,i18nKey:"DatabaseCard.button.copy"})})}),(0,O.BX)(m.ZP,{item:!0,xs:1,children:[(0,O.tZ)(w.Z,{open:G,onClose:P,children:(0,O.tZ)(F,{index:t,onReplace:P})}),(0,O.tZ)(x.Z,{fullWidth:!0,component:"span",color:"info",startIcon:(0,O.tZ)(u,{}),onClick:K,children:$(Q||(Q=nt`DatabaseCard.button.upload`))})]}),(0,O.tZ)(m.ZP,{item:!0,xs:1,children:(0,O.tZ)(x.Z,{fullWidth:!0,disabled:!M,onClick:L,startIcon:(0,O.tZ)(p.Z,{}),children:$(tt||(tt=nt`DatabaseCard.button.download`))})}),(0,O.tZ)(m.ZP,{item:!0,xs:1,children:(0,O.tZ)(x.Z,{fullWidth:!0,disabled:!M,color:"error",onClick:z,startIcon:(0,O.tZ)(g,{}),children:$(et||(et=nt`DatabaseCard.button.delete`))})})]})})]})})]})}var lt=n(94380),ot=n(45475),it=n(83673),ct=n(58918);function st(){const{t}=(0,i.$G)();return(0,O.BX)(y.Z,{children:[(0,O.BX)(a.Z,{sx:{py:1},children:[t("settings:languageCard.selectLanguage")," ",(0,O.tZ)(it.Z,{color:"warning",children:t("ui:underConstruction")})]}),(0,O.tZ)(l.Z,{}),(0,O.tZ)(a.Z,{children:(0,O.tZ)(Zt,{})})]})}const dt={chs:"\u7b80\u4f53\u4e2d\u6587",cht:"\u7e41\u9ad4\u4e2d\u6587",de:"Deutsch",en:"English",es:"Espa\xf1ol",fr:"Fran\xe7ais",id:"Bahasa Indonesia",it:"Italiano",ja:"\u65e5\u672c\u8a9e",ko:"\ud55c\uad6d\uc5b4",pt:"Portugu\xeas",ru:"\u0420\u0443\u0441\u0441\u043a\u0438\u0439 \u044f\u0437\u044b\u043a",th:"\u0e20\u0e32\u0e29\u0e32\u0e44\u0e17\u0e22",tr:"T\xfcrk\xe7e",vi:"Ti\u1ebfng Vi\u1ec7t"};function Zt(){const{t,i18n:e}=(0,i.$G)(["ui","settings"]),n=t=>()=>e.changeLanguage(t),a=e.languages[0];return(0,O.tZ)(ot.Z,{fullWidth:!0,title:t("settings:languageCard.languageFormat",{language:t(`languages:${a}`)}),children:ct.C.map((t=>(0,O.BX)(lt.Z,{selected:a===t,disabled:a===t,onClick:n(t),children:[(0,O.tZ)(i.cC,{i18nKey:`languages:${t}`}),t!==a?` (${dt[t]})`:""]},t)))})}function ht(){const{t}=(0,i.$G)(["settings"]);return o.ZP.send({hitType:"pageview",page:"/setting"}),(0,O.BX)(c.Z,{sx:{my:1},children:[(0,O.tZ)(a.Z,{sx:{py:1},children:(0,O.tZ)(r.Z,{variant:"subtitle1",children:(0,O.tZ)(i.cC,{t,i18nKey:"title"})})}),(0,O.tZ)(l.Z,{}),(0,O.BX)(a.Z,{sx:{display:"flex",flexDirection:"column",gap:2},children:[(0,O.tZ)(st,{}),(0,O.tZ)(at,{})]})]})}}}]);